window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f176","name":"udf_DestDirection","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"udf_DestDirection"},{"field":"Type","value":"Function"}],"script":"CREATE FUNCTION [dbo].[udf_DestDirection] \r\n(\r\n  @SrceX FLOAT = NULL\r\n ,@SrceY FLOAT = NULL\r\n ,@DestX FLOAT = NULL\r\n ,@DestY FLOAT = NULL\r\n)\r\nRETURNS varchar(2)\r\n\r\nWITH SCHEMABINDING, RETURNS NULL ON NULL INPUT\r\n\r\nAS\r\n-------------------------------------------------------------------------\r\n-- FUNCTION NAME : udf_DestDirection\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : This function return the general direction of the destination\r\n--                  in reference to the source point. \r\n--\r\n-- ASSUMPTIONS    : Must have valid Long Lat coordinate for both srce and dest\r\n--\r\n-- CALLED BY      : GetLeads\r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   :   @SrceX  source long (Optional)\r\n--                    @SrceY  source lat (Optional)\r\n--                    @DestX  Dest   long (Optional)\r\n--                    @DestY  Dest   lat (Optional)\r\n--                 \r\n-- OUTPUT PARAMS  : None\r\n-- STATUS RETURN  : Returns the direction abbreviation (ie N, NE, SW...)\r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR   DATE        DESCRIPTION\r\n-- Hiro     2018.03.16  Initial Development \r\n-------------------------------------------------------------------------\r\n\r\nBEGIN --FUNCTION\r\ndeclare @angle  float\r\ndeclare @Return varchar(2)\r\n\r\n-------------------------------------------------------\r\n--                    North x gets larger  (50)\r\n-- West y less postive (-128)           East (-60) gets more positive \r\n--                    Souty y gets smaller (25)\r\n-------------------------------------------------------\r\n\r\n-------------------------------------------------------\r\n-- Handle Dest due N/S/E/W or same point\r\n-------------------------------------------------------\r\nIF (@SrceX=@DestX) AND (@SrceY=@DestY) \r\n   RETURN '-' \r\n\r\n-------------------------------------------------------\r\n-- Due North or South of each other\r\n-------------------------------------------------------\r\nIF (@SrceX=@DestX)\r\n   BEGIN\r\n      If (@SrceY>@DestY)\r\n         RETURN 'S'\r\n      If (@SrceY<@DestY)\r\n         RETURN 'N'\r\n   END\r\n\r\n-- Due East or West of each other\r\nIF (@SrceY=@DestY)\r\n   BEGIN\r\n      IF (@SrceX<@DestX)\r\n         RETURN 'E'\r\n      IF (@SrceX>@DestX) \r\n         RETURN 'W'\r\n   END\r\n\r\n-------------------------------------------------------\r\n-- Determine angle in 1-360 degrees\r\n-------------------------------------------------------\r\nSELECT @angle = DEGREES(ATan( ((@DestY-@SrceY)/(@DestX-@SrceX)) ) )\r\nIF  @angle < 0\r\n  BEGIN\r\n     IF (@DestX < @SrceX)   \r\n        SELECT @angle = 180 + @angle --quad 2\r\n     ELSE\r\n        SELECT @angle = 360 + @angle --quad 4\r\n  END\r\nELSE\r\n  BEGIN\r\n     If (@DestX < @SrceX)\r\n        SELECT @angle = 180 + @angle --quad 3\r\n  END\r\n\r\n-------------------------------------------------------\r\n-- resolve direction (+- 22.5 degrees from 8 directions)\r\n--                    ie: 67.5 <= NE <= 22.5\r\n-------------------------------------------------------\r\nSELECT @return = \r\n  CASE WHEN @angle <  22.6 THEN 'E'\r\n       WHEN @angle <  67.6 THEN 'NE'\r\n       WHEN @angle < 112.6 THEN 'N'\r\n       WHEN @angle < 157.6 THEN 'NW'\r\n       WHEN @angle < 202.6 THEN 'W'\r\n       WHEN @angle < 247.6 THEN 'SW'\r\n       WHEN @angle < 292.6 THEN 'S'\r\n       WHEN @angle < 337.5 THEN 'SE'\r\n       ELSE 'E'\r\nEND\r\n\r\nRETURN @return\r\n\r\nEND --function","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"varchar(2)","custom_fields":{}},{"name":"SrceX","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"SrceY","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"DestX","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"DestY","description":null,"mode":"IN","data_type":"float","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};