window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p315","name":"usp_UpdateAssignedEquipment","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_UpdateAssignedEquipment"},{"field":"Type","value":"Procedure"}],"script":"-----------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_UpdateAssignedEquipment\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Update(Assign) EquipmentID,DriverID, and UserID to AssignedLoad\r\n--\r\n-- ASSUMPTIONS    : \r\n-- CALLED BY      : \r\n-- EXECUTION FREQUENCY : OnDemand\r\n--\r\n-- INPUT PARAMS   : @EToken       - EquipmentPosting's Token \r\n--                  @UpdatedBy    - Link's UserId \r\n--                  @DriverID     - EntityTypeId (Driver:1) from Entity table from Asset DB \r\n--                  @EquipmentID  - EntityTypeId (Truck:2) from Entity table from Asset DB \r\n--                  @UserId       - UserID that belong to DriverID  \r\n--                  \r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY :\r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.04.16 Initial Release\r\n---------------------------------------------------------------------------\r\nCREATE PROCEDURE  [dbo].[usp_UpdateAssignedEquipment]\r\n    @PIN            INT ,\r\n    @EToken         INT ,\r\n    @UpdatedBy      INT ,\r\n    @DriverID       INT = NULL ,\r\n    @EquipmentID    INT = NULL ,\r\n    @UserId         INT = NULL\r\nAS BEGIN \r\nDECLARE @ReturnValue INT = 0\r\nBEGIN TRY\r\n\r\n    DECLARE @CustCD VARCHAR(10) = NULL\r\n    ---- Get the CustCd from Account Table for Now *********** We need to move this Account table into LoadMatching database **************\r\n    IF (@UserId IS NOT NULL)\r\n    BEGIN\r\n        SELECT @CustCD = dbo.udf_GetCustCd (@UserId)\r\n    END\r\n\r\n\r\n\tUPDATE dbo.AssignedLoad \r\n\tSET \r\n        UserId      = ISNULL(@UserId, UserId) ,  \r\n        CustCD      = ISNULL(@CustCD ,CustCD) ,     \r\n        DriverID    = ISNULL(@DriverID , DriverID) ,     \r\n        EquipmentID = ISNULL(@EquipmentID , EquipmentID) ,     \r\n        UpdatedBy   = @UpdatedBy ,\r\n        UpdatedOn   = GETUTCDATE()\r\n\tWHERE PIN = @PIN \r\n    AND DeletedOn IS NULL -- Only Update Assigned Load not deleted\r\n\r\n    IF (@@ROWCOUNT <> 0)\r\n    BEGIN\r\n        SELECT @ReturnValue = Token\r\n        FROM   dbo.AssignedLoad\r\n        WHERE  PIN = @PIN\r\n        AND    EToken = @EToken  \r\n    END\r\nEND TRY\r\nBEGIN CATCH\r\n    SET @ReturnValue = -1\r\n\r\n    SELECT \r\n        ERROR_NUMBER() AS ErrorNumber,\r\n        ERROR_MESSAGE() AS ErrorMessage;\r\nEND CATCH;\r\n\r\nSELECT @ReturnValue       ReturnValue\r\nRETURN @ReturnValue\r\n\r\nEND","parameters":[{"name":"PIN","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"EToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"UpdatedBy","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DriverID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"EquipmentID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"UserId","description":null,"mode":"IN","data_type":"int","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};