window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p204","name":"usp_CreateDATLoadPosting","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_CreateDATLoadPosting"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_CreateDATLoadPosting]\r\n    @Token          int           = 0 ,\r\n    @CustCD         varchar(10) ,\r\n    @DateAvail      date          = null, \r\n\r\n    @SrceID         int           = 0,\r\n    @SrceCity       varchar(50)   = '' ,\r\n    @SrceSt         varchar(2)    = '' ,\r\n    @SrceLong       float         = 0 , \r\n    @SrceLat        float         = 0 , \r\n    @SrceRadius     int           = 0 ,\r\n\r\n    @DestID         int           = 0,\r\n    @DestCity       varchar(50)   = '' ,\r\n    @DestSt         varchar(2)    = '' ,\r\n    @DestLong       float         = 0 , \r\n    @DestLat        float         = 0 , \r\n    @DestRadius     int           = 0 ,\r\n\r\n    @VSize          INT        = 0 ,\r\n    @VType          int           = 0 ,\r\n    @Comment        varchar(4096) = '' ,\r\n    @Distance       int           = 0 ,\r\n    @CreatedBy      int           = 0 , \r\n    @ReferenceID    varchar(12)   = '' ,\r\n    @StartDate      datetime2     = null , \r\n    @EndDate        datetime2     = null , \r\n    @SrceRegUS      bigint        = 0 ,\r\n    @SrceRegCDN     bigint        = 0 ,\r\n    @DestRegUS      bigint        = 0 ,\r\n    @DestRegCDN     bigint        = 0 ,\r\n\t@OrigPostDate\tdatetime2(7)  = null\t-- new parameter for L to P integration job \r\nAS\r\nBEGIN\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_CreateDATLoadPosting\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Create Load Posting\r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @CustCD       = Customer Code        \r\n--                  @DateAvail    = Availab\r\n--                  \r\n--                  @SrceID       = Source Point ID from Point table        \r\n--                  @SrceCity     = Source City\r\n--                  @SrceSt       = Source State      \r\n--                  @SrceLong     = Source Longitude      \r\n--                  @SrceLat      = Source Latitude       \r\n--                  @SrceRadius   = Source Radius    \r\n--                  \r\n--                  @DestID       = Destination City      \r\n--                  @DestCity     = Destination State          \r\n--                  @DestSt       = Destination Longitude      \r\n--                  @DestLong     = Destination Longitude       \r\n--                  @DestLat      = Destination Latitude       \r\n--                  @DestRadius   = Destination Radius\r\n--                  \r\n--                  @VSize        = Vehicle Size in numeric form      \r\n--                  @VType        = Vehilce Type in numeric form  \r\n--                  @Comment      = Commment\r\n--                  @CreatedBy    = UserId of caller\r\n--                  @ReferenceID  = DAT Posting's Unique identifier \r\n--                  @StartDate    = DAT Posting start time\r\n--                  @EndDate      = DAT Posting end time\r\n--                  @SrceRegUS    = Source Region code for US state\r\n--                  @SrceRegCDN   = Source Region code for Canadian Province\r\n--                  @DestRegUS    = Destination Region code for US state\r\n--                  @DestRegCDN   = Destination Region code for Canadian Province\r\n--\t\t\t\t\t@OrigPostDate = null : If null or empty, means platform posting - default it to getutcdate(). \r\n--\t\t\t\t\t\t\t\t\t\t\tIf it has a value, means coming from Legacy\r\n--                 \r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.08.23 Initial Development\r\n-- Hiro      2018.10.25 Use the GETDATE() instead of GETUTCDATE() to check if Available Date is valid(Not past), LLSIM-1726\r\n-- Vevian\t 2019.04.10\tLLSIM-2596: new optional parameter for legacy DAT load/Equipment postings posted date - Default to getutcdate()\r\n--------------------------------------------------------------------------\r\n--SET NOCOUNT ON;\r\n\r\nDECLARE \r\n    @Error              int = 0\r\n   ,@RowCount           int = 0 \r\n\r\n   ,@SrceRadiusDefault  int = 0 \r\n   ,@DestRadiusDefault  int = 0\r\n   ,@SrceCountry        int = 0 \r\n   ,@DestCountry        int = 0 \r\n\r\nBEGIN TRY\r\n\r\n    -------------------------------------------------------------------------------\r\n    -- If Token is 0 then generate a new values \r\n    -------------------------------------------------------------------------------\r\n    IF (@Token = 0)\r\n    BEGIN\r\n        SELECT @Token = Max(Token) + 1 FROM dbo.DATLoadPosting\r\n        SET @Token = ISNULL(@Token,1) -- If table is empty then set to 1\r\n    END\r\n\r\n\t-------------------------------------------------------------------------------\r\n\t-- Original/Legacy PostDate default - if not coming from Legacy\r\n\t-------------------------------------------------------------------------------\r\n\tIF (@OrigPostDate = '' or @OrigPostDate IS NULL)\r\n\tBEGIN\r\n\t\tset @OrigPostDate = GETUTCDATE()\r\n\tEND\r\n\r\n    -------------------------------------------------------------------------------\r\n    -- Validate DateAvail passed in\r\n    -------------------------------------------------------------------------------\r\n    IF (@DateAvail IS NULL OR CONVERT(date,@DateAvail,112) < CONVERT(date,GETDATE(),112))\r\n       SET @DateAvail = CONVERT(date,GETDATE(),112)\r\n\r\n    -------------------------------------------------------------------------------\r\n    -- Validate Source info\r\n    -------------------------------------------------------------------------------\r\n         \r\n    exec dbo.usp_GetValidLocation\r\n\t    @ID         = @SrceID  OUTPUT,\r\n\t    @City       = @SrceCity OUTPUT,\r\n\t    @StateCode  = @SrceSt OUTPUT,\r\n\t    @Country    = @SrceCountry OUTPUT,\r\n\t    @Long       = @SrceLong  OUTPUT, \r\n\t    @Lat        = @SrceLat  OUTPUT, \r\n\t    @Radius     = @SrceRadius  OUTPUT\r\n \r\n    -------------------------------------------------------------------------------\r\n    -- Validate Destination info\r\n    -------------------------------------------------------------------------------\r\n         \r\n    exec dbo.usp_GetValidLocation\r\n\t    @ID         = @DestID  OUTPUT,\r\n\t    @City       = @DestCity OUTPUT,\r\n\t    @StateCode  = @DestSt OUTPUT,\r\n\t    @Country    = @DestCountry OUTPUT,\r\n\t    @Long       = @DestLong  OUTPUT, \r\n\t    @Lat        = @DestLat  OUTPUT, \r\n\t    @Radius     = @DestRadius  OUTPUT\r\n\r\n    -------------------------------------------------------------------------------\r\n    INSERT INTO dbo.DATLoadPosting \r\n    (   \r\n        Token ,\r\n        CustCd ,\r\n        DateAvail ,\r\n\r\n        SrceID ,\r\n        SrceCity ,\r\n        SrceSt ,\r\n        SrceCountry ,\r\n        SrceLong ,\r\n        SrceLat ,\r\n        SrceRadius ,\r\n\r\n        DestID ,\r\n        DestCity ,\r\n        DestSt ,\r\n        DestCountry ,\r\n        DestLong ,\r\n        DestLat ,\r\n        DestRadius ,\r\n\r\n        VSize ,\r\n        VType ,\r\n        Comment ,\r\n        Distance ,\r\n        CreatedBy ,\r\n        ReferenceID ,\r\n        StartDate ,\r\n        EndDate ,\r\n        SrceRegUS ,\r\n        SrceRegCDN ,\r\n        DestRegUS ,\r\n        DestRegCDN ,\r\n\t\tCreatedOn\r\n    )\r\n    VALUES        \r\n    (\r\n        @Token ,\r\n        @CustCd ,        \r\n        @DateAvail, \r\n\r\n        @SrceID ,         \r\n        @SrceCity ,\r\n        @SrceSt ,\r\n        @SrceCountry ,\r\n        @SrceLong , \r\n        @SrceLat  , \r\n        @SrceRadius ,\r\n\r\n        @DestID ,         \r\n        @DestCity ,\r\n        @DestSt ,\r\n        @DestCountry ,\r\n        @DestLong , \r\n        @DestLat , \r\n        @DestRadius ,\r\n\r\n        @VSize ,\r\n        @VType ,\r\n        @Comment ,\r\n        @Distance ,\r\n        @CreatedBy ,\r\n        @ReferenceID ,\r\n        @StartDate ,\r\n        @EndDate ,  \r\n        @SrceRegUS ,\r\n        @SrceRegCDN ,\r\n        @DestRegUS ,\r\n        @DestRegCDN ,\r\n\t\t@OrigPostDate\r\n    )\r\n\r\nEND TRY\r\nBEGIN CATCH\r\n    SET @Token = -1\r\n\r\nEND CATCH\r\n    SELECT @Token       Token\r\n\r\nRETURN @Token\r\n\r\nEND","parameters":[{"name":"Token","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"CustCD","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"DateAvail","description":null,"mode":"IN","data_type":"date","custom_fields":{}},{"name":"SrceID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"SrceCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"SrceSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"SrceLong","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"SrceLat","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"SrceRadius","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"DestSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"DestLong","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"DestLat","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"DestRadius","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"VSize","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"VType","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"Comment","description":null,"mode":"IN","data_type":"varchar(4096)","custom_fields":{}},{"name":"Distance","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"CreatedBy","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"ReferenceID","description":null,"mode":"IN","data_type":"varchar(12)","custom_fields":{}},{"name":"StartDate","description":null,"mode":"IN","data_type":"datetime2(7)","custom_fields":{}},{"name":"EndDate","description":null,"mode":"IN","data_type":"datetime2(7)","custom_fields":{}},{"name":"SrceRegUS","description":null,"mode":"IN","data_type":"bigint","custom_fields":{}},{"name":"SrceRegCDN","description":null,"mode":"IN","data_type":"bigint","custom_fields":{}},{"name":"DestRegUS","description":null,"mode":"IN","data_type":"bigint","custom_fields":{}},{"name":"DestRegCDN","description":null,"mode":"IN","data_type":"bigint","custom_fields":{}},{"name":"OrigPostDate","description":null,"mode":"IN","data_type":"datetime2(7)","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};