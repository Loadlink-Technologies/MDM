window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p216","name":"usp_CreateLoad","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_CreateLoad"},{"field":"Type","value":"Procedure"}],"script":"-- #3\r\nCREATE PROCEDURE [dbo].[usp_CreateLoad]\r\n    @CustCD         varchar(10) ,\r\n    @DateAvail      date\t\t\t= null, \r\n\r\n    @SrceID         int\t\t\t\t= 0,\r\n    @SrceCity       varchar(50)\t\t= '' ,\r\n    @SrceSt         varchar(2)\t\t= '' ,\r\n    @SrceLong       float\t\t\t= 0 , \r\n    @SrceLat        float\t\t\t= 0 , \r\n    --\t@SrceCoord      geography     = 0 , -- Note: The type 'sys.geography' is not supported with natively compiled modules.\r\n    @SrceRadius     int\t\t\t\t= 0 ,\r\n\r\n    @DestID         int\t\t\t\t= 0,\r\n    @DestCity       varchar(50)\t\t= '' ,\r\n    @DestSt         varchar(2)\t\t= '' ,\r\n    @DestLong       float\t\t\t= 0 , \r\n    @DestLat        float\t\t\t= 0 , \r\n    --\t@DestCoord      geography     = 0 , -- Note: The type 'sys.geography' is not supported with natively compiled modules.\r\n    @DestRadius     int\t\t\t\t= 0 ,\r\n\r\n    @VSize          INT\t\t\t= 0 ,\r\n    @VType          int\t\t\t\t= 0 ,\r\n    @Comment        varchar(4096)\t= '' ,\r\n    @PostMode       char(1)\t\t\t= 'A' ,\r\n    @ClientRefNum   varchar(256)\t= '' ,\r\n    @ProductName    varchar(25)\t\t= '' ,\r\n    @PAttrib        INT\t\t\t= 0 ,\r\n    @CreatedBy      int\t\t\t\t= 0 ,\r\n    @NetworkId      int\t\t\t\t= 0 ,\r\n\r\n    @OriginalToken  int\t\t\t\t= 0,\r\n\t@OrigPostDate\tdatetime2(7)\t= null,\t-- new parameter for L to P integration job\r\n\t@GlobalExcluded\tbit\t\t\t\t= 0\t \r\n\r\n--AS \r\n--BEGIN\r\nAS\r\nBEGIN\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_CreateLoad\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Create Load Posting is a super set that will perform freightmatching\r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @CustCD        = Customer Code        \r\n--                  @DateAvail     = Availab\r\n--                                 \r\n--                  @SrceID        = Source Point ID from Point table        \r\n--                  @SrceCity      = Source City\r\n--                  @SrceSt        = Source State      \r\n--                  @SrceLong      = Source Longitude      \r\n--                  @SrceLat       = Source Latitude       \r\n--                  @SrceRadius    = Source Radius    \r\n--                                 \r\n--                  @DestID        = Destination City      \r\n--                  @DestCity      = Destination State          \r\n--                  @DestSt        = Destination Longitude      \r\n--                  @DestLong      = Destination Longitude       \r\n--                  @DestLat       = Destination Latitude       \r\n--                  @DestRadius    = Destination Radius\r\n--                                 \r\n--                  @VSize         = Vehicle Size in numeric form      \r\n--                  @VType         = Vehilce Type in numeric form  \r\n--                  @Comment       = Commment\r\n--                  @PostMode      = A(default): Visible to all, P: Private Network\r\n--                  @ClientRefNum  = Client internal Reference Number \r\n--                  @ProductName   = Caller's Product Name\r\n--                  @PAttrib       = Posting Attribute in numeric form\r\n--                  @CreatedBy     = UserId of caller\r\n--                  @NetworkId     = When @PostMode is P then NetworkID otherwise 0\r\n--                  @OriginalToken = 0(default): If non zero then it will contain Token value from Legacy system \r\n--\t\t\t\t\t@OrigPostDate  = null : If null or empty, means platform posting - default it to getutcdate(). \r\n--\t\t\t\t\t\t\t\t\t\t\tIf it has a value, means coming from Legacy\r\n--\t\t\t\t\t@GlobalExcluded= 0(default) or 1 - value to identify Globally excluded customers\r\n--                 \r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2017.11.16 Initial Development\r\n-- Hiro      2018.04.11 Removed Route column and input parameter\r\n-- Hiro      2018.09.07 OriginalToken input parameter will have Token from Legacy system if exist.\r\n-- Hiro      2018.09.14 Ignore Legacy Posting from DAT matching \r\n-- Vevian\t 2019.02.11\tLLSIM-2245: New logic added to SPs that create new postings in Legacy which requires a small change in the output of this SP.\r\n--\t\t\t\t\t\t\t\t\trefer to JIRA ticket for full details.\r\n-- Vevian\t 2019.04.10\tLLSIM-2589: new optional parameter for legacy load postings posted date - Default to getutcdate()\r\n-- Vevian\t 2019.08.02\tLLSIM-3110: Implement Global exclude logic in Create Load and Equipment Stored procedures\r\n--\t\t\t\t\t\t\t\t\tNew optional input parameter @GlobalExcluded with default 0\r\n--------------------------------------------------------------------------\r\n--SET NOCOUNT ON;\r\n\r\nDECLARE \r\n    @Error              int = 0\r\n   ,@RowCount           int = 0 \r\n\r\n   ,@Token              int = 0\r\n\r\nBEGIN TRY\r\n\t-- Original/Legacy PostDate default - if not coming from Legacy\r\n\tIF (@OrigPostDate = '' or @OrigPostDate IS NULL)\r\n\tBEGIN\r\n\t\tset @OrigPostDate = GETUTCDATE()\r\n\tEND\r\n\r\n    -- Add Posting into EquipmentPosting table\r\n   exec @Token = dbo.usp_CreateLoadPosting\r\n        @CustCD ,       \r\n        @DateAvail ,    \r\n\r\n        @SrceID ,       \r\n        @SrceCity ,     \r\n        @SrceSt ,      \r\n        @SrceLong ,     \r\n        @SrceLat ,      \r\n        @SrceRadius ,    \r\n\r\n        @DestID ,       \r\n        @DestCity ,     \r\n        @DestSt ,       \r\n        @DestLong ,     \r\n        @DestLat ,      \r\n        @DestRadius ,   \r\n\r\n        @VSize ,        \r\n        @VType ,        \r\n        @Comment ,      \r\n        @PostMode ,     \r\n        @ClientRefNum , \r\n        @ProductName , \r\n        @PAttrib ,      \r\n        @CreatedBy , \r\n        @NetworkId ,\r\n        @OriginalToken,\r\n\t\t@OrigPostDate\r\n\r\n    IF (@Token <> -1)\r\n        BEGIN\r\n            -- Perfrom Equipment Load Matching\r\n        exec dbo.usp_MatchLoadPosting\r\n                @LoadToken = @Token,\r\n\t\t\t\t@GlobalExclude = @GlobalExcluded     \r\n\t\t\t\t\r\n            -- Perfrom DAT Load Matching if Platform Posting\r\n            IF (@OriginalToken = 0)\r\n                BEGIN\r\n                    exec dbo.usp_MatchLinkToDATLoadPosting\r\n                        @Token     \r\n                END\r\n        END \r\nEND TRY\r\nBEGIN CATCH\r\n    SET @Token = -1\r\nEND CATCH\r\n\r\n-- Commented this out because it is not needed and it breaks new Logic in LLNET (refer to JIRA ticket LLSIM-2245 for full details)\r\n--SELECT @Token       Token\r\n\r\nRETURN @Token\r\n\r\nEND","parameters":[{"name":"CustCD","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"DateAvail","description":null,"mode":"IN","data_type":"date","custom_fields":{}},{"name":"SrceID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"SrceCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"SrceSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"SrceLong","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"SrceLat","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"SrceRadius","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"DestSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"DestLong","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"DestLat","description":null,"mode":"IN","data_type":"float","custom_fields":{}},{"name":"DestRadius","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"VSize","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"VType","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"Comment","description":null,"mode":"IN","data_type":"varchar(4096)","custom_fields":{}},{"name":"PostMode","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"ClientRefNum","description":null,"mode":"IN","data_type":"varchar(256)","custom_fields":{}},{"name":"ProductName","description":null,"mode":"IN","data_type":"varchar(25)","custom_fields":{}},{"name":"PAttrib","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"CreatedBy","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"NetworkId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"OriginalToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"OrigPostDate","description":null,"mode":"IN","data_type":"datetime2(7)","custom_fields":{}},{"name":"GlobalExcluded","description":null,"mode":"IN","data_type":"bit","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};