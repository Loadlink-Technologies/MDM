window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p326","name":"usp_UpdatePointCityRank","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_UpdatePointCityRank"},{"field":"Type","value":"Procedure"}],"script":"----------------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_UpdatePointCityRank\r\n----------------------------------------------------------------------------------\r\n-- DESCRIPTION    : Update Point table to add CityRank value based on Legacy Loads\r\n--\r\n--\t\t\t\t\tCityRank Value will be between 0 and 7. logic will based on SrceCount value\r\n--\t\t\t\t\tcoming from Legacy Loads SrceCity as follows:\r\n--\t\t\t\t\t\tSrceCount 0-50\t\t\t= CityRank 0\r\n--\t\t\t\t\t\tSrceCount 51-200\t\t= CityRank 1\r\n--\t\t\t\t\t\tSrceCount 201-1000\t\t= CityRank 2\r\n--\t\t\t\t\t\tSrceCount 1001-3000\t\t= CityRank 3\r\n--\t\t\t\t\t\tSrceCount 3001-10000\t= CityRank 4\r\n--\t\t\t\t\t\tSrceCount 10001-60000\t= CityRank 5\r\n--\t\t\t\t\t\tSrceCount 60001-100000\t= CityRank 6\r\n--\t\t\t\t\t\tSrceCount 100001 & up\t= CityRank 7\r\n----------------------------------------------------------------------------------\r\n-- HISTORY :\r\n-- AUTHOR\t\tDATE\t\t\tDESCRIPTION\r\n-- Vevian\t\t2019.02.21\t\tInitial Release\r\n----------------------------------------------------------------------------------\r\nCREATE PROCEDURE [dbo].[usp_UpdatePointCityRank]\r\n\r\nAS\r\n\r\nUPDATE Point \r\nSET CityRank = CASE \r\n\t\t\t\tWHEN A.SrceCount between 0 and 50 \r\n\t\t\t\t\tTHEN 0 \r\n\t\t\t\tWHEN A.SrceCount between 51 and 200\r\n\t\t\t\t\tTHEN 1\r\n\t\t\t\tWHEN A.SrceCount between 201 and 1000\r\n\t\t\t\t\tTHEN 2\r\n\t\t\t\tWHEN A.SrceCount between 1001 and 3000\r\n\t\t\t\t\tTHEN 3\r\n\t\t\t\tWHEN A.SrceCount between 3001 and 10000\r\n\t\t\t\t\tTHEN 4\r\n\t\t\t\tWHEN A.SrceCount between 10001 and 60000\r\n\t\t\t\t\tTHEN 5\r\n\t\t\t\tWHEN A.SrceCount between 60001 and 100000\r\n\t\t\t\t\tTHEN 6\r\n\t\t\t\tWHEN A.SrceCount > 100000\r\n\t\t\t\t\tTHEN 7\r\n\t\t\t\tELSE 0 \r\n\t\t\t\tEND \r\n\t\t\t\t\tFROM\r\n\t\t\t\t\t\t(SELECT distinct SrceCity + ',' + SrceSt as Src, count(SrceCity + ',' + SrceSt) as SrceCount\r\n\t\t\t\t\t\tFROM PRODUCTION.[Production].[dbo].[Linkloads_Arch]\r\n\t\t\t\t\t\twhere PostDate >= DATEADD(YEAR,-1,getdate())\r\n\t\t\t\t\t\tgroup by SrceCity,SrceSt) A\r\n\t\t\t\t\t\tinner join \r\n\t\t\t\t\t\tPoint B on (A.Src = (B.City + ',' + B.StateCode))\r\n\r\n--set CityRank = 0 for all other Cities not updated above.\r\nUPDATE Point SET CityRank = 0 WHERE CityRank IS NULL\r\n\r\nIF (@@ERROR = 0)\r\n\tBEGIN\r\n\t\tprint 'City Rank Updated Successfully.'\r\n\tEND\r\nELSE\r\n\tBEGIN\r\n\t\tprint 'There was an error updating City Rank.'\r\n\tEND","parameters":[],"dependencies":null,"imported_at":"2021-07-29 12:59"};