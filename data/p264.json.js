window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p264","name":"usp_GetFlag","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetFlag"},{"field":"Type","value":"Procedure"}],"script":"-- 2\r\nCREATE PROCEDURE [dbo].[usp_GetFlag]\r\n    @Id     INT \r\n   ,@CustCD VARCHAR(10)\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetFlag\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get Flag information by Id  \r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @Id - Flag Id\r\n--                : @CustCD - Caller's CustCD\r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR   DATE       DESCRIPTION\r\n-- Hiro     2018.08.08 Initial Development\r\n--Jatinder  2019.03.26 LLSIM-2524 - As a flag user, the web API should return subscriber type from the back end\r\n--------------------------------------------------------------------------\r\nAS\r\nSET NOCOUNT ON\r\n\r\nDECLARE\r\n    @ContactCustCD  VARCHAR(10) \r\n   ,@LToken         INT \r\n   ,@EToken         INT \r\n   ,@LSrcCity       VARCHAR(50) = ''\r\n   ,@LSrcSt         VARCHAR(2)  = ''\r\n   ,@LDestCity      VARCHAR(50) = ''\r\n   ,@LDestSt        VARCHAR(2)  = ''\r\n   ,@LVType         VARCHAR(50) = ''\r\n   ,@LVSize         VARCHAR(50) = ''\r\n   ,@LPostedDate    DATETIME2(7)= ''\r\n   ,@LPAttrib       VARCHAR(20) = ''\r\n   ,@LComment       VARCHAR(4096) = ''\r\n   ,@PSrcCity       VARCHAR(50) = ''\r\n   ,@PSrcSt         VARCHAR(2)  = ''\r\n   ,@PDestCity      VARCHAR(50) = ''\r\n   ,@PDestSt        VARCHAR(2)  = ''\r\n   ,@PVType         VARCHAR(50) = ''\r\n   ,@PVSize         VARCHAR(50) = ''\r\n   ,@PPostedDate    DATETIME2(7)= '' \r\n   ,@PPAttrib       VARCHAR(50) = ''\r\n   ,@PComment       VARCHAR(4096) = ''\r\n   ,@PostType       CHAR(1) = '' \r\n\r\n   ,@ChatUserId\t    VARCHAR(100)\r\n   ,@Rating         FLOAT =ROUND( 5 *RAND(convert(varbinary, newid())), 2) --Temp: Generates Random rating \r\n   ,@RegisteredName VARCHAR(100) = ''\r\n   ,@Contact        VARCHAR(100) = ''\r\n   ,@Phone          VARCHAR(100) = ''\r\n   ,@Fax            VARCHAR(100) = ''\r\n   ,@HoursOfOperation VARCHAR(100) = ''\r\n   ,@Email          VARCHAR(100) = ''\r\n   ,@CustCDCounter int=0\r\n   ,@SubscriberType  VARCHAR(10)\r\n\t\r\n\t-- Get Flag Details\r\n    SELECT \r\n         @Id            = f.Id\r\n        ,@CustCD        = f.CustCd\r\n        ,@ContactCustCD = f.ContactCustCd\r\n        ,@LToken        = f.LToken\r\n        ,@EToken        = f.EToken\r\n\r\n        ,@LSrcCity      = f.LSrcCity     \r\n        ,@LSrcSt        = f.LSrcSt       \r\n        ,@LDestCity     = f.LDestCity    \r\n        ,@LDestSt       = f.LDestSt      \r\n        ,@LVSize        = f.LVSize       \r\n        ,@LVType        = f.LVType       \r\n        ,@LPostedDate   = f.LPostedDate\r\n        ,@LPAttrib      = f.LPAttrib\r\n        ,@LComment      = f.LComment\r\n\r\n        ,@PSrcCity      = f.PSrcCity     \r\n        ,@PSrcSt        = f.PSrcSt       \r\n        ,@PDestCity     = f.PDestCity    \r\n        ,@PDestSt       = f.PDestSt      \r\n        ,@PVSize        = f.PVSize       \r\n        ,@PVType        = f.PVType       \r\n        ,@PPostedDate   = f.PPostedDate\r\n        ,@PPAttrib      = f.PPAttrib\r\n        ,@PComment      = f.PComment\r\n\r\n        ,@PostType      = f.PostType  \r\n    FROM dbo.Flag f\r\n    WHERE f.Id = @Id\r\n    AND f.CustCd = @CustCD\r\n\r\n\t-- Ensure we have Flag Details \r\n\t\tIF (@ContactCustCD != '')\r\n\tBEGIN\r\n\t\tselect @CustCDCounter= count(custCD) from main.dbo.account where CustCD=@ContactCustCD\r\n\t\tif(@CustCDCounter>0)\r\n\t\tBEGIN\r\n\t\t\tSELECT\r\n\t\t\t\t@RegisteredName   = a.RegisteredName\r\n\t\t\t   ,@Contact          = u.FirstName + ' ' + u.LastName \r\n\t\t\t   ,@Phone            = c.Phone\r\n\t\t\t   ,@Fax              = a.Fax\r\n\t\t\t   ,@HoursOfOperation = a.HoursOfOperation\r\n\t\t\t   ,@Email            = c.Email \r\n\t\t\t   ,@ContactCustCD    = @ContactCustCD\r\n\t\t\t   ,@ChatUserId       = u.ChatUserId \r\n\t\t\t   ,@SubscriberType\t  = a.SubscriberType\r\n\t\t\tFROM Main.dbo.Account a\r\n\t\t\tLEFT JOIN Main.dbo.Contact c ON a.AccountId = c.AccountId and c.ContactType = 'Primary'\r\n\t\t\tLEFT JOIN Main.dbo.Users u   ON c.UserId = u.UserId\r\n\t\t\tWHERE a.CustCD = @ContactCustCD\r\n\t\tEND\r\n\t\tElse\r\n\t\tBEGIN\t\t\t\r\n\t\t\tselect @CustCDCounter= count(custCD) from DATCustomer where CustCD=@ContactCustCD\r\n\t\t\tif(@CustCDCounter>0)\r\n\t\t\tBEGIN\r\n\t\t\t\tSELECT \r\n\t\t\t\t \t@RegisteredName\t\t= a.XMT_NAME\r\n\t\t\t\t\t,@Contact\t\t\t= FIRST_NAME + ' ' + LAST_NAME\r\n\t\t\t\t\t,@Phone\t\t\t\t= XMT_PHONE\r\n\t\t\t\t    ,@Fax\t\t\t\t= COMPANY_FAX_PHONE\r\n\t\t\t\t    ,@HoursOfOperation\t= ''\r\n\t\t\t\t\t,@Email\t\t\t\t=EMAIL_ADDRESS \r\n\t\t\t\t\t,@ContactCustCD    = @ContactCustCD\r\n\t\t\t\t\t,@ChatUserId       = '' \r\n\t\t\t\t\t,@SubscriberType   ='DAT'\r\n\t\t\t\tFROM DATCustomer a\r\n\t\t\t\tWHERE a.CustCD = @ContactCustCD\r\n\t\t\tEND\r\n\t\tEND\r\n\r\n        SELECT\r\n             @Id                          AS Id\r\n            ,@CustCD                      AS CustCD\r\n            ,@ContactCustCD               AS ContactCustCD \r\n            ,@LToken                      AS LToken\r\n            ,@EToken                      AS EToken\r\n            ,@ChatUserId                  AS ChatUserId\r\n            ,@RegisteredName              AS RegisteredName\r\n            ,ISNULL(@Contact,'')          AS Contact \r\n            ,@Phone                       AS Phone \r\n            ,ISNULL(@Fax,'')              AS Fax \r\n            ,ISNULL(@HoursOfOperation,'') AS HoursOfOperation \r\n            ,@Email                       AS Email \r\n            ,@Rating                      AS Rating  \r\n            ,@LPostedDate                 AS LPostedDate\r\n            ,@LSrcCity                    AS LSrcCity\r\n            ,@LSrcSt                      AS LSrcSt\r\n            ,@LDestCity                   AS LDestCity  \r\n            ,@LDestSt                     AS LDestSt \r\n            ,@LVSize                      AS LVSize\r\n            ,@LVType                      AS LVType    \r\n            ,@LPAttrib                    AS LPAttrib\r\n            ,@LComment                    AS LComment\r\n            ,@PPostedDate                 AS PPostedDate \r\n            ,@PSrcCity                    AS PSrcCity    \r\n            ,@PSrcSt                      AS PSrcSt  \r\n            ,@PDestCity                   AS PDestCity \r\n            ,@PDestSt                     AS PDestSt     \r\n            ,@PVSize                      AS PVSize       \r\n            ,@PVType                      AS PVType \r\n            ,@PPAttrib                    AS PPAttrib\r\n            ,@PComment                    AS PComment\r\n            ,@PostType                    AS PostType\r\n\t\t\t,@SubscriberType\t\t\t  As SubscriberType\r\n\tEND","parameters":[{"name":"Id","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"CustCD","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};