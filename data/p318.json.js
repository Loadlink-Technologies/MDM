window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p318","name":"usp_UpdateContacted","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_UpdateContacted"},{"field":"Type","value":"Procedure"}],"script":"----------------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_UpdateContacted                                           \r\n----------------------------------------------------------------------------------\r\n-- DESCRIPTION    : This SP Delete a customer from Contacted if exist OR          \r\n--                : Add a customer in Cuntacted if not exists.                    \r\n--                :                                                               \r\n-- CALLED BY      : Platform API                                          \r\n--                :                                                               \r\n----------------------------------------------------------------------------------\r\n-- HISTORY :                                                                      \r\n-- AUTHOR    DATE           DESCRIPTION                                           \r\n-- Hiro      2018.04.09     Initial Development                                   \r\n----------------------------------------------------------------------------------\r\n\r\nCREATE PROCEDURE [dbo].[usp_UpdateContacted]\r\n@UserId        INT,\r\n@CnCustCd      VARCHAR(10),\r\n@LToken        INT = 0,\r\n@EToken        INT = 0\r\n\r\nAS\r\nSET NOCOUNT ON\r\n\r\nDECLARE @CustCd Varchar(10) = ''\r\n---- Get the CustCd from Account Table for Now \r\nSELECT @CustCd = dbo.udf_GetCustCd (@UserId)\r\n\r\nIF @LToken IS NULL \r\n   SET @LToken = 0\r\n\r\nIF (@CustCd IS NOT NULL AND @CustCd <> '')         AND\r\n   (@CnCustCd IS NOT NULL AND @CnCustCd <> '')     AND  \r\n   (@EToken IS NOT NULL AND @EToken >= 0)          AND\r\n   (@LToken IS NOT NULL AND @LToken >= 0)\r\n  BEGIN\r\n     IF EXISTS (SELECT 'X' From dbo.Contacted \r\n                 WHERE LToken   = @LToken   \r\n                   AND EToken   = @EToken\r\n                   AND CnCustCd = @CnCustCd \r\n                   AND CustCd   = @CustCd) \r\n        BEGIN\r\n           DELETE FROM dbo.Contacted \r\n                 WHERE LToken   = @LToken   \r\n                   AND EToken   = @EToken\r\n                   AND CnCustCd = @CnCustCd \r\n                   AND CustCd   = @CustCd\r\n        END\r\n     ELSE\r\n        BEGIN\r\n           INSERT INTO Contacted(CustCd, CnCustCd, LToken, EToken,CreatedBy)\r\n           VALUES(@CustCd,@CnCustCd,@LToken, @EToken,@UserId)\r\n        END\r\n  END","parameters":[{"name":"UserId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"CnCustCd","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"LToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"EToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};