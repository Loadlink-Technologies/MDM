window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p295","name":"usp_GetUSMembers","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetUSMembers"},{"field":"Type","value":"Procedure"}],"script":"-- =========================================================================================== \r\n\r\nCREATE PROCEDURE [dbo].[usp_GetUSMembers] \r\n\t@CompanyName\tVARCHAR(50) = ''\r\n\t,@ProvSt\t\tCHAR(2) = ''\r\n\t,@Phone\t\t\tVARCHAR(15) = ''\r\n\t,@ShowExcluded\tSmallInt = 0\r\n\t,@CustCd\t\tVARCHAR(10) = ''\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetUSMembers\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get DAT/US Member Search\r\n--\r\n-- CALLED BY      : FreightMatching Web API \r\n-- INPUT PARAMS   : @CompanyName        - Name of Company/Member to search\r\n--                  @ProvSt\t\t\t\t- Member/Company State\r\n--\t\t\t\t\t@Phone\t\t\t\t- Member/Company Phone number\r\n--\t\t\t\t\t@ShowExcluded\t\t- flag to show excluded members in the search result\r\n--\t\t\t\t\t@CustCd\t\t\t\t- CustCd of customer performing the member search\r\n----------------------------------------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR\t\tDATE\t\tDESCRIPTION\r\n-- Vevian\t\t2018.08.29\tInitial Development\r\n-- Vevian\t\t2018.09.06\t1) Use DATFinanceIndex table instead of FinanceIndex\r\n--\t\t\t\t\t\t\t2) DATCustomer \"Account_ID\" field is used to join with DATFinanceIndex table (instead of \"CUSTCD\" field)\r\n--\t\t\t\t\t\t\t3) Change SType static value from \"US\" to \"DAT\"\r\n-- Rajesh\t\t2019.04.11\tChanging value of ShowExcluded (0=>All, 1=> Include, 2=>Exclude).\r\n-- Nesrin       2019.11.08  LLSIM-3544: Display canceled accounts and the Last connected date\r\n--                                      Also, changed the null values of the Account_ID to 0\r\n-------------------------------------------------------------------------------------------------------------\r\nAS\r\nSET NOCOUNT ON\r\n\r\nDECLARE @MaxRecords\t\t\t\tINT = 700;\r\n \t\t     \r\nSELECT TOP (@MaxRecords)\r\n    A.CustCd, \r\n    CASE WHEN A.ACCOUNT_ID IS NULL THEN 0 ELSE  A.ACCOUNT_ID END as AccountId,\r\n    ISNULL(A.XMT_NAME,'NA') as CompanyName,\r\n    A.XMT_PHONE as Phone,\r\n    'DAT' AS SType,\r\n\tISNULL((SELECT 1 FROM Exclude Exl WHERE Exl.ExcludeCustCd = A.CustCD AND Exl.CustCd = @CustCd), 0) AS Excluded,\r\n\tISNULL((SELECT DispatchNote FROM Member M WHERE M.MemberCustCd = A.CustCD AND M.CustCd = @CustCd), '') AS DispatchNote,\r\n\t-1 Equifax ,     \r\n    -1 TCC ,\r\n\tISNULL(CAST(Idx.Analysis AS INTEGER), -1) TCUS,\r\n\tCASE WHEN CLOSE_DATE IS NULL THEN 1 ELSE 0 END StatusId, \r\n\tCASE WHEN CLOSE_DATE IS NULL THEN NULL ELSE LAST_USED END  'LastUsed'\r\n\r\nFROM \r\n\tDatCustomer A \r\n\t\tLEFT JOIN Finance.dbo.TransCredit Idx ON Idx.CustCD = A.Account_ID \r\n\r\nWHERE \r\n\t(@CompanyName = '' OR A.XMT_NAME LIKE @CompanyName + '%')\r\n\tAND (@ProvSt = '' OR A.HOMEPROV = @ProvSt)\r\n\tAND (@Phone = '' OR A.XMT_PHONE = @Phone)\r\n\tAND (\r\n\t\t\t(@ShowExcluded = 0 \r\n\t\t\t\tAND NOT EXISTS (SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = @CustCd AND x.ExcludeCustCd = A.CustCd) \r\n\t\t\t) \r\n\t\t\tOR @ShowExcluded = 1\r\n\t\t\tOR (@ShowExcluded = 2 \r\n\t\t\t\tAND EXISTS (SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = @CustCd AND x.ExcludeCustCd = A.CustCd) \r\n\t\t\t) \r\n\t\t)\t\r\nORDER BY \r\n\tA.XMT_NAME DESC","parameters":[{"name":"CompanyName","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"ProvSt","description":null,"mode":"IN","data_type":"char(2)","custom_fields":{}},{"name":"Phone","description":null,"mode":"IN","data_type":"varchar(15)","custom_fields":{}},{"name":"ShowExcluded","description":null,"mode":"IN","data_type":"smallint","custom_fields":{}},{"name":"CustCd","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};