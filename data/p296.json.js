window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p296","name":"usp_GetValidLocation","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetValidLocation"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_GetValidLocation]\r\n\t@ID           int           = 0  OUTPUT,\r\n\t@City         varchar(50)   = '' OUTPUT,\r\n\t@StateCode    varchar(2)    = '' OUTPUT,\r\n\t@Country      int           = 0  OUTPUT,\r\n\t@Long         float         = 0  OUTPUT, \r\n\t@Lat          float         = 0  OUTPUT, \r\n\t@Radius       int           = 0  OUTPUT,\r\n\t@MarketAreaID int           = 0  OUTPUT\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetValidLocation\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get Valid location from Point table. \r\n--\r\n-- CALLED BY      : Any SP that needs validate Point info.  \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : \t@ID        = Primary Key for the Point table\r\n--\t                    @City      = Name of City\r\n--\t                    @StateCode = State / Province Code\r\n--                 \r\n-- OUTPUT PARAMS  :     @ID           = Primary Key for the Point table\r\n--                      @City         = Name of City\r\n--                      @StateCode    = State / Province Code\r\n--                      @Country      = Country \r\n--                      @Long         = Longitude\r\n--                      @Lat          = Latitude\r\n--                      @Radius       = Default Radius\r\n--                      @MarketAreaID = Market Area ID for given Point\r\n\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.04.26 Initial Development\r\n-- Vevian\t 2020.04.13\tLLSIM-4061: Code optimization after converting memory-optimized tables to Desk-based tables\r\n--------------------------------------------------------------------------\r\nAS\r\nBEGIN\r\nDECLARE @RadiusDefault INT = 0\r\n\r\nBEGIN TRY\r\n    IF (@ID <> 0)\r\n       -- Read Point record to retrieve default info\r\n       BEGIN\r\n\t\t\tSELECT \r\n\t\t\t\t  @City          = City\r\n\t\t\t\t ,@StateCode     = StateCode\r\n\t\t\t\t ,@Country       = Country\r\n\t\t\t\t ,@Long          = Long\r\n\t\t\t\t ,@Lat           = Lat\r\n\t\t\t\t ,@RadiusDefault = Radius\r\n\t\t\t\t ,@MarketAreaID  = MarketAreaID\r\n\t\t\tFROM Mileage.dbo.Point \r\n\t\t\tWHERE ID = @ID\r\n       END\r\n    ELSE    --(@SrceID <> 0)\r\n       BEGIN\r\n         -- City exists but was not passed as id (This Should Never happen)\r\n\t\t\tSELECT TOP 1\r\n\t\t\t\t  @ID            = ID\r\n\t\t\t\t ,@City          = City\r\n\t\t\t\t ,@StateCode     = StateCode\r\n\t\t\t\t ,@Country       = Country\r\n\t\t\t\t ,@Long          = Long\r\n\t\t\t\t ,@Lat           = Lat\r\n\t\t\t\t ,@RadiusDefault = Radius\r\n\t\t\t\t ,@MarketAreaID  = MarketAreaID\r\n\t\t\tFROM Mileage.dbo.Point  \r\n\t\t\tWHERE StateCode = @StateCode \r\n\t\t\t\tAND City      = @City\r\n        \r\n         IF (@@rowcount = 0 OR @ID IS NULL)\r\n             -- nothing exists get state average (This Should Never happen)\r\n             SELECT \r\n                  @ID           = 0\r\n                 ,@City         = ''\r\n                 ,@StateCode    = ''\r\n                 ,@Country      = 0\r\n                 ,@Long         = 0\r\n                 ,@Lat          = 0\r\n                 ,@Radius       = 0\r\n                 ,@MarketAreaID = 0 \r\n       END\r\nEND TRY\r\nBEGIN CATCH\r\n    SELECT \r\n         @ID           = 0\r\n        ,@City         = ''\r\n        ,@StateCode    = ''\r\n        ,@Country      = 0\r\n        ,@Long         = 0\r\n        ,@Lat          = 0\r\n        ,@Radius       = 0\r\n        ,@MarketAreaID = 0;\r\n\r\n\t--select \r\n\t--ERROR_NUMBER() AS ErrorNumber,\r\n --   ERROR_STATE() AS ErrorState,\r\n --   ERROR_SEVERITY() AS ErrorSeverity,\r\n --   ERROR_PROCEDURE() AS ErrorProcedure,\r\n --   ERROR_LINE() AS ErrorLine,\r\n --   ERROR_MESSAGE() AS ErrorMessage;\r\nEND CATCH\r\nEND","parameters":[{"name":"ID","description":null,"mode":"INOUT","data_type":"int","custom_fields":{}},{"name":"City","description":null,"mode":"INOUT","data_type":"varchar(50)","custom_fields":{}},{"name":"StateCode","description":null,"mode":"INOUT","data_type":"varchar(2)","custom_fields":{}},{"name":"Country","description":null,"mode":"INOUT","data_type":"int","custom_fields":{}},{"name":"Long","description":null,"mode":"INOUT","data_type":"float","custom_fields":{}},{"name":"Lat","description":null,"mode":"INOUT","data_type":"float","custom_fields":{}},{"name":"Radius","description":null,"mode":"INOUT","data_type":"int","custom_fields":{}},{"name":"MarketAreaID","description":null,"mode":"INOUT","data_type":"int","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};