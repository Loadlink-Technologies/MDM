window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p259","name":"usp_GetEquipmentPosting","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetEquipmentPosting"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_GetEquipmentPosting]\r\n    @CustCd\t\t\t\tVARCHAR(10) \r\n  , @Token\t\t\t\tINT = NULL\r\n  , @MileageProvider\tCHAR(1) = 'P' -- G=Google (Default), P=PCMiler \r\n  , @GetDAT\t\t\t\tBIT = 0\r\n\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetEquipmentPosting\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get Equipment Posting\r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @CustCd   - Customer Code\r\n--                  @Token    - Posting's Primary key, NULL will return all active posting\r\n--                  @GetDAT   - Optional parameter for the leads count if the user is subscribed to DAT\r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n---------------------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.04.11 Initial Development\r\n-- Hiro      2018.10.24 Do not return the Legacy posting to Platform User (LLSIM-1721)\r\n-- Nesrin    2018.12.27 Return the actual value of VSize & PAttrib fields required for Reposting cancelled order (LLSIM-2026)\r\n-- Nesrin    2019.03.08\tLLSIM-1758: Change the Default value of @MileageProvider to P to get the PCMilerMiles\r\n-- Nesrin    2019.11.12 LLSIM-3580: Update \"usp_GetEquipmentPosting\" to get the CustomerTracking value with the equipment posting information\r\n-- Nesrin    2020.03.03 LLSIM-3991: Update GET list to retrieve equipment leads count \r\n-- Vevian\t 2020.04.09\tLLSIM-4061: Code optimization after converting memory-optimized tables to Desk-based tables\r\n-- Nesrin    2020.04.14 LLSIM-4061: Script current Loadmatching DB and create a new one with no memory optimized tables\r\n-----------------------------------------------------------------------------------------\r\n AS\r\nBEGIN\r\n    SELECT\r\n        e.Token ,\r\n        e.CustCD ,\r\n        e.DateAvail ,\r\n\r\n        e.SrceID ,\r\n        e.SrceCity ,\r\n        e.SrceSt ,\r\n        e.SrceCountry ,\r\n        e.SrceLong ,\r\n        e.SrceLat ,\r\n        e.SrceRadius ,\r\n        p1.MarketAreaID SrceMarketAreaID,\r\n\r\n        e.DestID ,\r\n        e.DestCity ,\r\n        e.DestSt ,\r\n        e.DestCountry ,\r\n        e.DestLong ,\r\n        e.DestLat ,\r\n        e.DestRadius ,\r\n        p2.MarketAreaID DestMarketAreaID,\r\n\t\tvs.Code VehicleSize,\r\n      -- dbo.udf_VSizeToString(e.VSize,'E') VehicleSize ,\r\n        dbo.udf_VTypeToString(e.VType) VehicleType ,\r\n        e.Comment ,\r\n        e.PostMode ,\r\n        e.ClientRefNum ,\r\n        e.ProductName ,\r\n        dbo.udf_PostingAttributeToString(PAttrib) PostingAttrib ,\r\n        dbo.udf_GetMileage(e.SrceID,e.DestID,@MileageProvider) Distance,\r\n        e.CreatedBy ,\r\n        e.CreatedOn ,\r\n        e.DeletedBy ,\r\n        e.DeletedOn ,\r\n        e.VType ,\r\n        e.PStatus ,\r\n        e.NetworkId ,\r\n        dbo.udf_ConvertLLVtypeToRIVtype(e.VType) RIType ,\r\n        e.Corridor ,\r\n\t\te.VSize,\r\n\t\te.PAttrib,\r\n\t\te.OriginalToken,\r\n\t\te.CustomerTracking,\r\n\t\t[dbo].[udf_GetEquipmentLeadsCount] (@CustCd,e.Token,@GetDAT)  LeadsCount\t\t\r\n    FROM dbo.EquipmentPosting e WITH(NOLOCK)\r\n    INNER JOIN dbo.Point p1 WITH(NOLOCK) ON e.SrceID = p1.ID \r\n    INNER JOIN dbo.Point p2 WITH(NOLOCK) ON e.DestID = p2.ID \r\n\tINNER JOIN dbo.VehicleSize vs WITH(NOLOCK) ON vs.Value = e.VSize AND vs.PostType='E'\r\n    WHERE CustCd = @CustCd\r\n    AND (@Token IS NULL OR @Token = Token)\r\n    AND DeletedOn IS NULL\r\n    AND e.OriginalToken = 0 -- Only return the Platform Posting (LLSIM-1721)\r\nEND","parameters":[{"name":"CustCd","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"Token","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"MileageProvider","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"GetDAT","description":null,"mode":"IN","data_type":"bit","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};