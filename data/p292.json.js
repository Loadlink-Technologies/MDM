window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p292","name":"usp_GetUserLegacyDeleted","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetUserLegacyDeleted"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_GetUserLegacyDeleted]\r\n    @CustCD\t\tVARCHAR(10),\r\n\t@LeadType\tCHAR\r\n\r\n--------------------------------------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetUserLegacyDeleted\r\n--------------------------------------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get user's list of deleted Legacy posting tokens that  \r\n--\t\t\t\t\twere not deleted from LiveLeads list  \r\n-- \r\n-- INPUT PARAMS   : @CustCD\t\t- Logged in User's CustCD\r\n--\t\t\t\t\t@LeadType\t- 'L' = Load Leads, 'E' = Equipment Leads\r\n--\t\t\t\t\t\t\t\t, 'B' = Both Load and Equipment Leads\r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR\t\tDATE\t\t\tDESCRIPTION\r\n-- Vevian\t\t2019.05.17\t\tLLSIM-2697: Initial Development\r\n-- Nesrin       2019.06.06      LLSIM-2852: Modify the stored procedure to include the deleted DAT leads\r\n-- Vevian\t\t2019.06.27\t\tLLSIM-2967: remove the condition to check for only secondary lead type ('S')\r\n----------------------------------------------------------------------------------------------------------\r\nAS \r\n\r\nIF (@LeadType = 'L')\r\n\tBEGIN\r\n\t\tSELECT * FROM LegacyDeleted WHERE LLDeleted = 0\r\n\t\tAND token in (select LoadLead.EToken from\r\n\t\t(\r\n\t\t\tSELECT\tE.Token\tEToken \r\n\t\t\tFROM\tdbo.LoadLead LL INNER JOIN dbo.LoadPosting L ON LL.LToken=L.Token\r\n\t\t\t\t\t\t\t\t\tINNER JOIN dbo.EquipmentPosting E ON LL.EToken=E.Token\r\n\t\t\tWHERE\tL.CustCd = @CustCD\r\n\t\t\t\t\tAND  E.PStatus = 'O' -- Open\r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = @CustCd  AND x.ExcludeCustCd = E.CustCd) ) \r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = E.CustCd AND x.ExcludeCustCd = @CustCd ) ) \r\n\t\t\t\t\t--AND (LL.LeadType = 'S') -- In LiveLead only return the secondary match lead.\r\n\r\n\t\tUnion \r\n\t\t\tSELECT\tDE.Token\tEToken \r\n\t\t\tFROM\tdbo.DATLoadLead DLL INNER JOIN dbo.LoadPosting L ON DLL.LToken=L.Token\r\n\t\t\t\t\t\t\t\t\tINNER JOIN dbo.DATEquipmentPosting DE ON DLL.EToken=DE.Token\r\n\r\n\t\t\tWHERE\tL.CustCd = @CustCD\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t) LoadLead)\r\n\tEND\r\n\r\nELSE IF (@LeadType = 'E')\r\n\tBEGIN\r\n\t\tSELECT * FROM LegacyDeleted WHERE LLDeleted = 0\r\n\t\tAND token in (select EquipLead.LToken from\r\n\t\t(\r\n\t\t\tSELECT\tL.Token\tLToken\r\n\t\t\tFROM\tdbo.EquipmentLead EL\tINNER JOIN dbo.LoadPosting L ON EL.LToken=L.Token\r\n\t\t\t\t\t\t\t\t\t\t\tINNER JOIN dbo.EquipmentPosting E ON EL.EToken=E.Token\r\n\t\t\tWHERE\tE.CustCd = @CustCD\r\n\t\t\t\t\tAND  L.PStatus = 'O' -- Open\r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = @CustCd  AND x.ExcludeCustCd = L.CustCd) ) \r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = L.CustCd AND x.ExcludeCustCd = @CustCd ) ) \r\n\t\t\t\t\t--AND (EL.LeadType = 'S') -- In LiveLead only return the secondary match lead.\r\n\r\n\t\tUnion\r\n\t\t\tSELECT DL.Token LToken\r\n\t\t\tFROM dbo.DATEquipmentLead DEL    INNER JOIN dbo.DATLoadPosting DL ON DEL.LToken=DL.Token\r\n                                    INNER JOIN dbo.EquipmentPosting E ON DEL.EToken=E.Token\t\r\n\t\t\tWHERE\tE.CustCd = @CustCD\r\n\t\t) EquipLead)\r\n\tEND\r\n\r\nELSE IF (@LeadType = 'B')\r\n\tBEGIN\r\n\t\tSELECT * FROM LegacyDeleted WHERE LLDeleted = 0\r\n\t\tAND token in (select LoadLead.EToken from\r\n\t\t(\r\n\t\t\tSELECT\tE.Token\tEToken \r\n\t\t\tFROM\tdbo.LoadLead LL INNER JOIN dbo.LoadPosting L ON LL.LToken=L.Token\r\n\t\t\t\t\t\t\t\t\tINNER JOIN dbo.EquipmentPosting E ON LL.EToken=E.Token\r\n\t\t\tWHERE\tL.CustCd = @CustCD\r\n\t\t\t\t\tAND  E.PStatus = 'O' -- Open\r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = @CustCd  AND x.ExcludeCustCd = E.CustCd) ) \r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = E.CustCd AND x.ExcludeCustCd = @CustCd ) ) \r\n\t\t\t\t\t--AND (LL.LeadType = 'S') -- In LiveLead only return the secondary match lead.\r\n\t\t\tUnion \r\n\t\t\tSELECT\tDE.Token\tEToken \r\n\t\t\tFROM\tdbo.DATLoadLead DLL INNER JOIN dbo.LoadPosting L ON DLL.LToken=L.Token\r\n\t\t\t\t\t\t\t\t\tINNER JOIN dbo.DATEquipmentPosting DE ON DLL.EToken=DE.Token\r\n\r\n\t\t\tWHERE\tL.CustCd = @CustCD\r\n\t\t) LoadLead)\r\n\t\tUNION\r\n\t\tSELECT * FROM LegacyDeleted WHERE LLDeleted = 0\r\n\t\tAND token in (select EquipLead.LToken from\r\n\t\t(\r\n\t\t\tSELECT\tL.Token\tLToken\r\n\t\t\tFROM\tdbo.EquipmentLead EL\tINNER JOIN dbo.LoadPosting L ON EL.LToken=L.Token\r\n\t\t\t\t\t\t\t\t\t\t\tINNER JOIN dbo.EquipmentPosting E ON EL.EToken=E.Token\r\n\t\t\tWHERE\tE.CustCd = @CustCD\r\n\t\t\t\t\tAND  L.PStatus = 'O' -- Open\r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = @CustCd  AND x.ExcludeCustCd = L.CustCd) ) \r\n\t\t\t\t\tAND (NOT EXISTS ( SELECT 'X' FROM Exclude x (NOLOCK) WHERE x.CustCd = L.CustCd AND x.ExcludeCustCd = @CustCd ) ) \r\n\t\t\t\t\t--AND (EL.LeadType = 'S') -- In LiveLead only return the secondary match lead.\r\n\r\n\t\t\tUnion\r\n\t\t\tSELECT DL.Token LToken\r\n\t\t\tFROM dbo.DATEquipmentLead DEL    INNER JOIN dbo.DATLoadPosting DL ON DEL.LToken=DL.Token\r\n                                    INNER JOIN dbo.EquipmentPosting E ON DEL.EToken=E.Token\t\r\n\t\t\tWHERE\tE.CustCd = @CustCD\r\n\t\t) EquipLead)\r\n\tEND","parameters":[{"name":"CustCD","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"LeadType","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};