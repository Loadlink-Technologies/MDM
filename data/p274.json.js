window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p274","name":"usp_GetLoadLead_Combined","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetLoadLead_Combined"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_GetLoadLead_Combined]        \r\n  @CustCD\t\t\tVARCHAR(10)\r\n ,@LToken           INT\t\t\t= 0\r\n ,@ServerName       VARCHAR(75) = '' \r\n ,@Version          VARCHAR(50) = 'V4.00'\r\n ,@MileageProvider  CHAR(1)\t\t= 'P'\t-- G=Google (Default), P=PCMiler \r\n ,@LeadFrom         DATETIME2\t= null\t-- TO BE USED LATER FOR LIVE LEADS IF REQUESTED\r\n ,@LeadsCap\t\t\tINT\t\t\t= 0\r\n ,@GetDAT\t\t\tBIT\t\t\t= 0\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetLoadmentLead_Combined\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get Load Lead (Link & DAT - if subscribed)\r\n--\r\n-- CALLED BY      : Integration API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @CustCD             - Caller CustCD\r\n--                  @LToken             - Load Token is pass if retrieving the Lead for 1 Load Posting         \r\n--                  @ServerName         - Name of Web Server where the request is coming from \r\n--                  @Version            - Version of calling Client\r\n--                  @MileageProvider    - Mileage Engine Provider, G=Google, P=PCMiler(Default)\r\n--                  @LeadFrom           - If null, then return all avilable lead, otherwise return any lead newer than @LeadFrom \r\n--\t\t\t\t\t@LeadsCap\t\t\t- If 0, then return ALL leads, otherwise return just the Cap number\r\n--                 \r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n-----------------------------------------------------------------------------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR\t\tDATE\t\t\tDESCRIPTION\r\n-- Vevian\t\t2019.11.07\t\tInitial Development\r\n--\t\t\t\t\t\t\t\tLLSIM-3557: Stored procedure to merge both Link & DAT Load Leads in 1 call instead of 2 seprate ones\r\n-- Vevian\t\t2020.03.17\t\tLLSIM-4002: combined leads for LLW4 + Add new leads field CustomerTracking\r\n-- Vevian\t\t2020.03.23\t\tLLSIM-4046: pass optional parameter \"LeadsCap\" to Leads SPs\r\n--\t\t\t\t\t\t\t\t\t\t0 = ALL Leads, >0 = Cap leads to this value.\r\n------------------------------------------------------------------------------------------------------------------------------------------------\r\nAS\r\n\r\n-- TO BE USED LATER FOR LIVE LEADS IF REQUESTED\r\n--DECLARE @LiveCall BIT = 1 -- 1=Live , 0=Non-Live\r\n--IF (@LeadFrom IS NULL)\r\n--BEGIN\r\n--    SELECT @LeadFrom = '19970101 00:00:00:000'\r\n--         , @LiveCall = 0\r\n--END\r\n\r\n\r\n/*Create a table with the same columns that the Leads SPs return*/\r\nDECLARE @LOADLEADSLIST AS TABLE (CustCD VARCHAR(10), DateAvail DATETIME2(7), SrceID INT, SrceCity VARCHAR(50), SrceSt VARCHAR(2), SrceCountry INT, SrceLong FLOAT, SrceLat FLOAT,\r\n\t\t\tDestID INT, DestCity VARCHAR(50), DestSt VARCHAR(2), DestCountry INT, DestLong FLOAT, DestLat FLOAT, VehicleSize VARCHAR(64), VehicleType VARCHAR(25),\r\n\t\t\tComment VARCHAR(4096), PostMode CHAR(1), ClientRefNum VARCHAR(256), ProductName VARCHAR(50), PostingAttrib VARCHAR(25), Distance DECIMAL(9,1),\r\n\t\t\tLToken INT, EToken INT, CreatedBy INT, CreatedOn DATETIME2(7), DeletedBy INT, DeletedOn DATETIME2(7),\r\n\t\t\tCompany VARCHAR(50), Phone VARCHAR(15), Email VARCHAR(255), QPStatus INT, Equifax INT, TCC INT, TCUS INT, DirO VARCHAR(2), DFO DECIMAL(9,1),\r\n\t\t\tDFD DECIMAL(9,1), Contacted VARCHAR(1), Flag INT, SubscriberType VARCHAR(50), PType CHAR, CustomerTracking BIT)\r\n\r\n\t\r\nIF (@GetDAT = 1)\r\n\tBEGIN\r\n\t\t-- GET LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\tINSERT @LOADLEADSLIST  \r\n\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t@CustCD\t\t\t\t= @CustCD         \r\n\t\t\t,@LToken\t\t\t= @LToken\r\n\t\t\t,@ServerName\t\t= @ServerName\r\n\t\t\t,@Version\t\t\t= @Version\r\n\t\t\t,@MileageProvider\t= @MileageProvider\r\n\t\t\t,@LeadFrom\t\t\t= @LeadFrom \r\n\t\t\t,@LeadsCap\t\t\t= @LeadsCap\r\n\r\n\t\t-- GET DAT LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\tINSERT @LOADLEADSLIST\r\n\t\tEXEC [usp_GetDATLoadLead] \r\n\t\t\t@CustCD\t\t\t\t= @CustCD         \r\n\t\t\t,@LToken\t\t\t= @LToken\r\n\t\t\t,@ServerName\t\t= @ServerName\r\n\t\t\t,@Version\t\t\t= @Version\r\n\t\t\t,@MileageProvider\t= @MileageProvider\r\n\t\t\t,@LeadFrom\t\t\t= @LeadFrom\r\n\t\t\t,@LeadsCap\t\t\t= @LeadsCap\r\n\r\n\t\t-- RETURN ALL LEADS COMBINED (IN DESC. ORDER)\r\n\t\t--SELECT * FROM @LOADLEADSLIST ORDER BY CreatedOn DESC\r\n\tEND\r\nELSE\r\n\tBEGIN\r\n\t\tINSERT @LOADLEADSLIST\r\n\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t@CustCD\t\t\t\t= @CustCD         \r\n\t\t\t,@LToken\t\t\t= @LToken\r\n\t\t\t,@ServerName\t\t= @ServerName\r\n\t\t\t,@Version\t\t\t= @Version\r\n\t\t\t,@MileageProvider\t= @MileageProvider\r\n\t\t\t,@LeadFrom\t\t\t= @LeadFrom \r\n\t\t\t,@LeadsCap\t\t\t= @LeadsCap\r\n\tEND\t\r\n\r\n--IF (@LiveCall = 1)\r\nIF (@LeadsCap > 0)\r\n\tBEGIN\r\n\t\tSELECT TOP (@LeadsCap) * FROM @LOADLEADSLIST \r\n\t\t-- show newer leads first\r\n\t\tORDER BY CreatedOn DESC\r\n\tEND\r\nELSE\r\n\tBEGIN\r\n\t\tSELECT * FROM @LOADLEADSLIST\r\n\t\t-- show newer leads first\r\n\t\tORDER BY CreatedOn DESC\r\n\tEND","parameters":[{"name":"CustCD","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"LToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"ServerName","description":null,"mode":"IN","data_type":"varchar(75)","custom_fields":{}},{"name":"Version","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"MileageProvider","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"LeadFrom","description":null,"mode":"IN","data_type":"datetime2(7)","custom_fields":{}},{"name":"LeadsCap","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"GetDAT","description":null,"mode":"IN","data_type":"bit","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};