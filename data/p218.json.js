window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p218","name":"usp_CreateLoadPosition","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_CreateLoadPosition"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_CreateLoadPosition] \r\n    @Token INT\r\nAS\r\n-----------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_CreateLoadPosition\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Creates record in LoadPosition table for given load\r\n--\r\n-- ASSUMPTIONS    : \r\n-- CALLED BY      : \r\n-- EXECUTION FREQUENCY : OnDemand\r\n--\r\n-- INPUT PARAMS   : @Token - Id of the load\r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY :\r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Vadym     2018.02.22 Initial Release\r\n-- Vadym     2018.06.27 Equipment position tracking\r\n-- Hiro      2018.06.28 Replaced the UserId with Driver's UserID (DriverID)\r\n-- Nesrin    2020.04.14 LLSIM-4061: Script current Loadmatching DB \r\n--\t\t\t\t\t\tand create a new one with no memory optimized tables\r\n---------------------------------------------------------------------------\r\nBEGIN\r\nSET NOCOUNT ON;\r\n\t\r\n\t\t\r\n\t\tBEGIN\t\r\n\t\tinsert into [dbo].[LoadPosition]\r\n\t\t(\r\n\t\t\t[LoadId],\r\n\t\t\t[CustCD],\r\n\t\t\t[UserId],\r\n\t\t\t[DeviceIMEI],\r\n\t\t\t[CreatedOn],\r\n\t\t\t[LoadStatus],\r\n\t\t\t[Lon],\r\n\t\t\t[Lat],\r\n\t\t\t[MessageId],\r\n\t\t\tEquipmentID,\r\n\t\t\tEToken\r\n\t\t)\r\n\t\tselect\r\n\t\t\tlp.[Token],\r\n\t\t\tlp.CustCD,\r\n\t\t\tal.DriverID UserId,\r\n\t\t\tim.[DeviceIMEI],\r\n\t\t\tGETUTCDATE(),\r\n\t\t\tlp.PStatus,\r\n\t\t\tim.GPSLongitude,\r\n\t\t\tim.GPSLatitude,\r\n\t\t\tim.[MessageId],\r\n\t\t\tal.EquipmentID,\r\n\t\t\tal.EToken\r\n\t\tfrom\r\n\t\t\t[dbo].[LoadPosting] lp\r\n\t\t\tinner join [dbo].[AssignedLoad] al\r\n\t\t\ton lp.Token = al.Token\r\n\t\t\tleft join Geo.dbo.InMessage im\r\n\t\t\ton (select MAX(m.MessageId) from Geo.dbo.InMessage m where m.Userid = al.DriverID) = im.MessageId\r\n\t\twhere\r\n\t\tlp.Token = @Token and\r\n\t\tlp.PStatus in ('R', 'D') and\r\n\t\tal.DeletedOn is null;\r\n\tend\r\n\r\nEND","parameters":[{"name":"Token","description":null,"mode":"IN","data_type":"int","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};