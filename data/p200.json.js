window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p200","name":"usp_CreateAssignedLoad","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_CreateAssignedLoad"},{"field":"Type","value":"Procedure"}],"script":"-----------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_CreateAssignedLoad\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Creates record in AssignedLoad table for given user\r\n--\r\n-- ASSUMPTIONS    : \r\n-- CALLED BY      : \r\n-- EXECUTION FREQUENCY : OnDemand\r\n--\r\n-- INPUT PARAMS   : @CreatedBy    - UserId of Load assignee \r\n--                  @UserId       - Driver or Carrier UserId \r\n--                  @Token        - Load Posting's Token\r\n--                  @Instruction  - Special Instruction for Driver or Carrier\r\n--                  @EToken       - Equipment Posting's Token for Carrier (Optional)\r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY :\r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.01.18 Initial Release\r\n-- Hiro      2018.04.16 Added optional EToken when assigning to Carrier \r\n---------------------------------------------------------------------------\r\nCREATE PROCEDURE [dbo].[usp_CreateAssignedLoad]\r\n    @CreatedBy      INT , \r\n    @Token          INT ,\r\n    @UserId         INT = 0 ,\r\n    @Instruction    VARCHAR(MAX) = '' ,\r\n    @EToken         INT = NULL \r\nAS BEGIN\r\n\r\nSET NOCOUNT ON\r\n\r\nDECLARE\r\n    @ID             INT         = 0 ,\r\n    @PIN            VARCHAR(9)  = 0 ,\r\n    @CustCd         VARCHAR(10) = ''\r\n\r\n\r\nBEGIN TRY\r\n    -------------------------------------------------------------------------------\r\n    -- Get CustCd for this users\r\n    -------------------------------------------------------------------------------\r\n    ---- Get the CustCd from Account Table for Now *********** We need to move this Account table into LoadMatching database **************\r\n    IF (@UserId <> 0)\r\n    BEGIN\r\n        SELECT @CustCD = dbo.udf_GetCustCd (@UserId)\r\n    END\r\n\r\n    -------------------------------------------------------------------------------\r\n    -- Generate 9 digits PIN with last digit as Check Digit\r\n    -------------------------------------------------------------------------------\r\n    SET @PIN = dbo.udf_GetPIN(NEWID(),DEFAULT)\r\n\r\n\r\n    INSERT INTO dbo.AssignedLoad \r\n    (\r\n       CustCd ,\r\n       UserId ,\r\n       Token ,\r\n       PIN ,\r\n       Instruction ,\r\n       CreatedBy, \r\n       EToken\r\n    )\r\n    VALUES \r\n    (\r\n       @CustCd ,\r\n       @UserId ,\r\n       @Token ,\r\n       @PIN ,\r\n       @Instruction ,\r\n       @CreatedBy ,\r\n       @EToken\r\n    )\r\n    SET @ID = SCOPE_IDENTITY()\r\n\r\nEND TRY\r\nBEGIN CATCH\r\n    SELECT @ID = -1 ,\r\n           @PIN = -1\r\n\r\n    SELECT \r\n        ERROR_NUMBER() AS ErrorNumber,\r\n        ERROR_MESSAGE() AS ErrorMessage;\r\nEND CATCH;\r\n\r\nSELECT  @ID     ID , \r\n        @PIN    PIN\r\n\r\nRETURN @PIN\r\n\r\nEND","parameters":[{"name":"CreatedBy","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"Token","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"UserId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"Instruction","description":null,"mode":"IN","data_type":"varchar(MAX)","custom_fields":{}},{"name":"EToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};