window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p222","name":"usp_CreateMileage","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_CreateMileage"},{"field":"Type","value":"Procedure"}],"script":"CREATE   PROCEDURE [dbo].[usp_CreateMileage]\r\n  @SrceID       INT\r\n ,@DestID       INT\r\n ,@GoogleMiles  DECIMAL(9,1) = NULL\r\n ,@PCMilerMiles DECIMAL(9,1) = NULL\r\n ,@CalcStatus   INT = NULL\r\nAS\r\nBEGIN\r\n\r\n-------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_CreateMileage\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : This routine add a new entry into the Mileage table.\r\n--                  Normally, Only the @SrceID and @DestID is sent in input parameter\r\n--                  and External processor (SSIS) will calculate the driving distance\r\n--                  by calling the Google & PCMiler API later on. \r\n--\r\n-- ASSUMPTIONS    : None\r\n-- CALLED BY      : \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @SrceID: Source Point ID from PCMiler\r\n--                  @DestID: Destination Point ID from PCMiler\r\n--                  @GoogleMiles: Driving distance from Google API\r\n--                  @PCMilerMiles: Driving distance from PCMiler API \r\n--                  @CalcStatus: 0=Uncalculated, 1=Google Only, 2=PCMiler, 3=Google & PCMiler \r\n--                 \r\n-- OUTPUT PARAMS  : none\r\n-- STATUS RETURN  : None\r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR   DATE        DESCRIPTION\r\n-- Hiro     2018.03.20  Initial Development \r\n-------------------------------------------------------------------------\r\n\r\n    DECLARE @MinID          INT\r\n          , @MaxID          INT\r\n          , @CalculatedOn   DATETIME2 = NULL\r\n          , @CheckMileage   CHAR(1) = ''\r\n\r\n    -- (#1) If @Miles IS Null\r\n    --\tRETURN\r\n\r\n    -- Lookup with Srce = min id, Dest = max id\r\n    IF @SrceID <= @DestID\r\n       BEGIN\r\n          SELECT @MinID = @SrceID\r\n          SELECT @MaxID = @DestID \r\n       END\r\n    ELSE\r\n       BEGIN\r\n          SELECT @MinID = @DestID\r\n          SELECT @MaxID = @SrceID          \r\n       END \r\n\r\n    SELECT @CheckMileage = 'X' \r\n                 FROM dbo.Mileage\r\n                WHERE SrceId = @MinID\r\n                  AND DestId = @MaxID\r\n           \r\n    IF (@@ROWCOUNT = 0) -- This Point doesn't exist so create a new Point in Mileage table.\r\n    BEGIN\r\n       IF (@GoogleMiles IS NOT NULL OR @PCMilerMiles IS NOT NULL)\r\n       BEGIN\r\n            SET @CalculatedOn = GETUTCDATE()\r\n       END\r\n       INSERT INTO dbo.Mileage \r\n              ( \r\n               SrceID \r\n              ,DestID\r\n              ,GoogleMiles\r\n              ,PCMilerMiles\r\n              ,CalcStatus\r\n              ,CalculatedOn\r\n              ) \r\n              VALUES\r\n              (\r\n               @MinID\r\n              ,@MaxID\r\n              ,@GoogleMiles\r\n              ,@PCMilerMiles\r\n              ,@CalcStatus\r\n              ,@CalculatedOn\r\n              )\r\n    END\r\nEND","parameters":[{"name":"SrceID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"GoogleMiles","description":null,"mode":"IN","data_type":"decimal(9, 1)","custom_fields":{}},{"name":"PCMilerMiles","description":null,"mode":"IN","data_type":"decimal(9, 1)","custom_fields":{}},{"name":"CalcStatus","description":null,"mode":"IN","data_type":"int","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};