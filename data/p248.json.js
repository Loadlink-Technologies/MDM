window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p248","name":"usp_GetCityList","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetCityList"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_GetCityList]\r\n  @Cityname VARCHAR(50),\r\n  @MaxCity SMALLINT = 10,\r\n  @SortType SMALLINT = 0\r\nAS\r\n----------------------------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetCityList                                                          \r\n----------------------------------------------------------------------------------------------\r\n-- DESCRIPTION    : This SP will RETURN Cities and States with same Soundex of the one that passed to  \r\n--                : Validate                                                                 \r\n-- CALLED BY      :    \r\n-- INPUT PARAMS   : @State    = State / Province Code        \r\n--                  @City     = City name\r\n--                  @MaxCity  = Maximum number of City list to return\r\n--\t\t\t\t\t@SortType = 0 (Alphabitical only - Default)\r\n--\t\t\t\t\t\t\t\t1 (by CityRank + Alphabitical)\r\n----------------------------------------------------------------------------------------------\r\n-- HISTORY :                                                                             \r\n-- AUTHOR  DATE       DESCRIPTION                                                         \r\n-- Hiro    2018.11.01 Initial Development \r\n-- Hiro    2018.11.07 Changed the City / State delimiter from space to comma to fix the issue with City name like New York.    \r\n-- Vevian  2018.11.21 change the Maximum cities to be returned from 5 to 20     \r\n-- Vevian  2019.02.21 LLSIM-1877: Add new optional parameter for Sorting & return sorted values.                                  \r\n----------------------------------------------------------------------------------------------\r\nSET NOCOUNT ON\r\n\r\nDECLARE\r\n  @State VARCHAR(2) = '',\r\n  @City  VARCHAR(50)\r\n\r\nDeclare @wait as char(5)\r\n\r\n--Set @City = Replace(@City,'''','''''') --Removed by Rs July 19th 2006 - this is not required, it conflict with ' character\r\n----------NOISE WORDS--------------\r\n--set @City = Replace(@City,'-','')-- -- Removed by RS July 5th 2006 - fix for Issue # LM2.0-177\r\nset @City = Replace(@City,'/','')--\r\nset @City = Replace(@City,'_','')--\r\nset @City = Replace(@City,'*','')--\r\n--set @City = Replace(@City,'.','')--\r\nset @City = Replace(@City,'+','')--\r\nset @City = Replace(@City,'=','')--\r\nset @City = Replace(@City,'$','')--\r\nset @City = Replace(@City,'#','')--\r\nset @City = Replace(@City,'^','')--\r\nset @City = Replace(@City,'%','')--\r\nset @City = Replace(@City,'!','')--\r\nset @City = Replace(@City,';','')--\r\nset @City = Replace(@City,'&','')--\r\nset @City = Replace(@City,'~','')--\r\n-----------------------------------\r\n\r\nSET @Cityname = LTRIM(RTRIM(@Cityname)) \r\n\r\nBEGIN TRY\r\n\r\n\tdeclare @SepIdx INT = CHARINDEX(',',@Cityname,1)\r\n\r\n\tIF LEN(@Cityname)>=1 \r\n\t  BEGIN\r\n\t\tDECLARE @CountryList TABLE (CountryCode SMALLINT, CountryName VARCHAR(50))\r\n\r\n\t\tINSERT @CountryList VALUES (1,'USA'),  (2,'Canada'), (3, 'Mexico') \r\n\r\n\t\tIF (@SepIdx <> 0)  -- State/Prov info provided\r\n\t\t\tBEGIN\r\n\t\t\t\tSELECT @City  = SUBSTRING(@Cityname,1,@SepIdx-1)  \r\n\t\t\t\t\t , @State = SUBSTRING(@Cityname,@SepIdx+1,2)\r\n\r\n\t\t\t\tif @SortType = 1\r\n\t\t\t\tbegin\r\n\t\t\t\t\tSELECT TOP (@MaxCity) City + ', ' + StateCode + ', ' + C.CountryName 'CityList'\r\n\t\t\t\t\t\t\tFROM dbo.Point P INNER JOIN @CountryList C ON P.Country = C.CountryCode\r\n\t\t\t\t\t\t\tWHERE StateCode LIKE LTRIM(RTRIM(@State)) + '%'\r\n\t\t\t\t\t\t\tAND City Like @City + '%'\r\n\t\t\t\t\t\t\tAND isVisible = 1  Order By cityRank Desc, City + StateCode Asc\r\n\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\tbegin\r\n\t\t\t\t\tSELECT TOP (@MaxCity) City + ', ' + StateCode + ', ' + C.CountryName 'CityList'\r\n\t\t\t\t\t\t\tFROM dbo.Point P INNER JOIN @CountryList C ON P.Country = C.CountryCode\r\n\t\t\t\t\t\t\tWHERE StateCode LIKE LTRIM(RTRIM(@State)) + '%'\r\n\t\t\t\t\t\t\tAND City Like @City + '%'\r\n\t\t\t\t\t\t\tAND isVisible = 1  Order By City + StateCode\r\n\t\t\t\tend\r\n\r\n\t\t\tEND\r\n\t\tELSE\r\n\t\t\tBEGIN -- Get All City that starts with City parameter\r\n\t\t\t\tif @SortType = 1\r\n\t\t\t\tbegin\r\n\t\t\t\t\tSELECT TOP (@MaxCity) City + ', ' + StateCode + ', ' + C.CountryName 'CityList'\r\n\t\t\t\t\tFROM dbo.Point P INNER JOIN @CountryList C ON P.Country = C.CountryCode\r\n\t\t\t\t\tWHERE City Like @Cityname + '%' \r\n\t\t\t\t\tAND isVisible = 1  Order By cityRank Desc, City + StateCode Asc\r\n\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\tbegin\r\n\t\t\t\t\tSELECT TOP (@MaxCity) City + ', ' + StateCode + ', ' + C.CountryName 'CityList'\r\n\t\t\t\t\tFROM dbo.Point P INNER JOIN @CountryList C ON P.Country = C.CountryCode\r\n\t\t\t\t\tWHERE City Like @Cityname + '%' \r\n\t\t\t\t\tAND isVisible = 1 Order By City + StateCode\r\n\t\t\t\tend\r\n\r\n\t\t\tEND\r\n\t  END\r\n\tELSE\r\n\t  BEGIN\r\n\t\tSELECT '' 'CityList'\r\n\t  END\r\n\r\nEND TRY\r\nBEGIN CATCH\r\n    SELECT '' 'CityList'\r\nEND CATCH","parameters":[{"name":"Cityname","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"MaxCity","description":null,"mode":"IN","data_type":"smallint","custom_fields":{}},{"name":"SortType","description":null,"mode":"IN","data_type":"smallint","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};