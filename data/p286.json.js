window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p286","name":"usp_GetPDRatio","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetPDRatio"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_GetPDRatio]\r\n    @VType    INT ,\r\n    @SrceSt   VARCHAR(2) ,\r\n    @SrceCity VARCHAR(50) ,\r\n    @DestSt   VARCHAR(2) ,\r\n    @DestCity VARCHAR(50)\r\n\r\n--------------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_GetPDRatio\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get posting index info\r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- \r\n-- INPUT PARAMS   :     @VType    = Vehicle Type Code\r\n--                      @SrceSt   - Source State/Province Code\r\n--                      @SrceCity - Source City\r\n--                      @DestSt   - Destination State/Province Code\r\n--                      @DestCity - Destination City\r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR\t\tDATE\t\tDESCRIPTION\r\n-- Vevian\t\t2018.10.03\tInitial Development\r\n--------------------------------------------------------------------------\r\nAS\r\nBEGIN\r\n\r\nDECLARE \r\n    @SrceMarketAreaId   INT = 0 ,\r\n    @DestMarketAreaId   INT = 0 ,\r\n\r\n    @WkOutEquip         INT = 0,\r\n    @WkOutLoad          INT = 0, \r\n    @WkOutRatio         NUMERIC(9,2) = -1,\r\n    @MthOutEquip        INT = 0, \r\n    @MthOutLoad         INT = 0,\r\n    @MthOutRatio        NUMERIC(9,2) = -1\r\n\r\n-- Retrieve Source Market Area\r\nEXEC dbo.usp_GetValidLocation\r\n\t@City         = @SrceCity OUTPUT,\r\n\t@StateCode    = @SrceSt OUTPUT,\r\n    @MarketAreaId = @SrceMarketAreaId OUTPUT\r\n\r\n-- Retrieve Destination Market Area\r\nEXEC dbo.usp_GetValidLocation\r\n\t@City         = @DestCity OUTPUT,\r\n\t@StateCode    = @DestSt OUTPUT,\r\n    @MarketAreaId = @DestMarketAreaId OUTPUT\r\n\r\nIF (@SrceMarketAreaId > 0 AND @DestMarketAreaId > 0)\r\n\tBEGIN\r\n\t\tSELECT \r\n\t\t\t@WkOutEquip  = ISNULL(SUM(P.WkOutEquip),0) ,\r\n\t\t\t@WkOutLoad   = ISNULL(SUM(P.WkOutLoad),0) ,\r\n\t\t\t@MthOutEquip = ISNULL(SUM(P.MthOutEquip),0) ,\r\n\t\t\t@MthOutLoad  = ISNULL(SUM(P.MthOutLoad),0) \r\n        FROM dbo.PDRatio P  \r\n        WHERE P.SrceMarketAreaID = @SrceMarketAreaId \r\n\t\t\tAND P.DestMarketAreaID = @DestMarketAreaId \r\n\t\t\tAND (@VType & P.VType) > 0 \r\n        GROUP BY \r\n\t\t\tP.SrceMarketAreaID,\r\n\t\t\tP.DestMarketAreaID\r\n\r\n        -- Calculate Ratio\r\n        IF (@WkOutEquip <> 0 AND @WkOutLoad <> 0)\r\n            SET @WkOutRatio = CAST(@WkOutEquip/(@WkOutLoad*1.0) AS numeric(9,2)) \r\n\r\n        IF ( @MthOutEquip <> 0 AND @MthOutLoad <> 0)\r\n            SET @MthOutRatio = CAST(@MthOutEquip/(@MthOutLoad*1.0) AS numeric(9,2)) \r\n    END\r\n\r\nSELECT\r\n\t@WkOutEquip  WkOutEquip ,\r\n    @WkOutLoad   WkOutLoad , \r\n    @WkOutRatio  WkOutRatio ,\r\n    @MthOutEquip MthOutEquip ,\r\n    @MthOutLoad  MthOutLoad ,\r\n    @MthOutRatio MthOutRatio \r\n\r\nEND","parameters":[{"name":"VType","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"SrceSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"SrceCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"DestSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"DestCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};