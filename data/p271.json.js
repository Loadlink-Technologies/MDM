window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p271","name":"usp_GetLiveLeadsList","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetLiveLeadsList"},{"field":"Type","value":"Procedure"}],"script":"-- =========================================================================================== \r\n\r\nCREATE   PROCEDURE [dbo].[usp_GetLiveLeadsList] \r\n  @CustCD\t\t\tvarchar(10)         \r\n ,@ServerName       Varchar(75) = '' \r\n ,@Version          Varchar(50) = 'V4.00'\r\n ,@MileageProvider  CHAR(1) = 'P' -- G=Google (Default), P=PCMiler \r\n ,@LeadFrom         datetime2\r\n ,@LeadType\t\t\tint\r\n ,@GetBDAT\t\t\tbit = 0\r\n ,@GetCDAT\t\t\tbit = 0\r\n\r\n--------------------------------------------------------------------------\r\n--PROCEDURE NAME : usp_GetLiveLeadsList\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get a list of live leads for the Users\r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : @CustCD             - Caller CustCD       \r\n--                  @ServerName         - Name of Web Server where the request is coming from \r\n--                  @Version            - Version of calling Client\r\n--                  @MileageProvider    - Mileage Engine Provider, G=Google(Default), P=PCMiler\r\n--                  @LeadFrom           - Return avilable lead newer than @LeadFrom \r\n--                  @LeadType\t\t\t- 0 = LOAD, 1 = EQUIP, 2 = ALL (Both Load & Equip leads)\r\n--                  @GetBDAT\t\t\t- Flag to get DAT Load leads (0 or 1)\r\n--                  @GetCDAT\t\t\t- Flag to get DAT Equip leads (0 or 1)\r\n-----------------------------------------------------------------------------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR    DATE\t\t\tDESCRIPTION\r\n-- Vevian    2019.06.27\t    Initial Development \r\n--\t\t\t\t\t\t\tLLSIM-2962: Create a centralized API controller for Live Lead \r\n-- Nesrin    2019.11.18     LLSIM-3623: Update the SP usp_GetLiveLeadsList to return the Customer Tracking value\r\n----------------------------------------------------------------------------------------------------------------------------------------------------\r\nAS\r\n\r\nDECLARE @Token\tINT = 0\r\n\r\n/*Create a table with the same columns that the Leads SPs return*/\r\nDECLARE @tempLeads AS TABLE (CustCD VARCHAR(10), DateAvail DATETIME2(7), SrceID INT, SrceCity VARCHAR(50), SrceSt VARCHAR(2), SrceCountry INT, SrceLong FLOAT, SrceLat FLOAT,\r\n\t\t\tDestID INT, DestCity VARCHAR(50), DestSt VARCHAR(2), DestCountry INT, DestLong FLOAT, DestLat FLOAT, VehicleSize VARCHAR(64), VehicleType VARCHAR(25),\r\n\t\t\tComment VARCHAR(4096), PostMode CHAR(1), ClientRefNum VARCHAR(256), ProductName VARCHAR(50), PostingAttrib VARCHAR(25), Distance DECIMAL(9,1),\r\n\t\t\tLToken INT, EToken INT, CreatedBy INT, CreatedOn DATETIME2(7), DeletedBy INT, DeletedOn DATETIME2(7),\r\n\t\t\tCompany VARCHAR(50), Phone VARCHAR(15), Email VARCHAR(255), QPStatus INT, Equifax INT, TCC INT, TCUS INT, DirO VARCHAR(2), DFO DECIMAL(9,1),\r\n\t\t\tDFD DECIMAL(9,1), Contacted VARCHAR(1), Flag INT, SubscriberType VARCHAR(50), PType CHAR, CustomerTracking bit)\r\n\r\nIF (@LeadType = 0)\t\t-- LOAD LEADS\r\n\tBEGIN\r\n\t\tIF (@GetBDAT = 1)\r\n\t\t\tBEGIN\r\n\t\t\t\t\t-- GET LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t\t,@LToken = @Token\r\n\t\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t\t,@Version = @Version\r\n\t\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t\t-- GET DAT LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\t\tINSERT @tempLeads\r\n\t\t\t\t\tEXEC [usp_GetDATLoadLead] \r\n\t\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t\t,@LToken = @Token\r\n\t\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t\t,@Version = @Version\r\n\t\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t\t,@LeadFrom = @LeadFrom\r\n\r\n\t\t\t\t\t-- RETURN ALL LEADS COMBINED (TOP 150 RECORDS IN DESC. ORDER)\r\n\t\t\t\t\tSELECT TOP 150 * FROM @tempLeads ORDER BY CreatedOn DESC\r\n\t\t\tEND\r\n\t\tELSE\r\n\t\t\tBEGIN\r\n\t\t\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t\t,@LToken = @Token\r\n\t\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t\t,@Version = @Version\r\n\t\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t\t,@LeadFrom = @LeadFrom\r\n\t\t\tEND\r\n\tEND\r\n\r\nELSE IF (@LeadType = 1)\t\t-- EQUIP. LEADS\r\n\tBEGIN\r\n\t\tIF (@GetCDAT = 1)\r\n\t\t\tBEGIN\r\n\t\t\t\t-- GET EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET DAT EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads\r\n\t\t\t\tEXEC [usp_GetDATEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom\r\n\r\n\t\t\t\t-- RETURN ALL LEADS COMBINED (TOP 150 RECORDS IN DESC. ORDER)\r\n\t\t\t\tSELECT TOP 150 * FROM @tempLeads ORDER BY CreatedOn DESC\r\n\t\t\tEND\r\n\t\tELSE\r\n\t\t\tBEGIN\r\n\t\t\t\tEXEC [usp_GetEquipmentLead]  \r\n\t\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t\t,@EToken = @Token\r\n\t\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t\t,@Version = @Version\r\n\t\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t\t,@LeadFrom = @LeadFrom\r\n\t\t\tEND\r\n\tEND\r\n\r\nELSE IF (@LeadType = 2)\t\t-- BOTH LOAD & EQUIP. LEADS\r\n\tBEGIN\r\n\t\tIF (@GetBDAT = 1 and @GetCDAT = 1)\t\t-- SUBSCRIBED TO DAT FOR BOTH BROKER AND CARRIER\r\n\t\t\tBEGIN\r\n\t\t\t\t-- GET LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@LToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET DAT LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads\r\n\t\t\t\tEXEC [usp_GetDATLoadLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@LToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom\r\n\r\n\t\t\t\t-- GET EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET DAT EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads\r\n\t\t\t\tEXEC [usp_GetDATEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom\r\n\r\n\t\t\t\t-- RETURN ALL LEADS COMBINED (TOP 150 RECORDS IN DESC. ORDER)\r\n\t\t\t\tSELECT TOP 150 * FROM @tempLeads ORDER BY CreatedOn DESC\r\n\t\t\tEND\r\n\r\n\t\tELSE IF (@GetBDAT = 1 and @GetCDAT <> 1) \t\t-- SUBSCRIBED TO DAT FOR BROKER ONLY\r\n\t\t\tBEGIN\r\n\t\t\t\t-- GET LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@LToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET DAT LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads\r\n\t\t\t\tEXEC [usp_GetDATLoadLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@LToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom\r\n\r\n\t\t\t\t-- GET EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- RETURN ALL LEADS COMBINED (TOP 150 RECORDS IN DESC. ORDER)\r\n\t\t\t\tSELECT TOP 150 * FROM @tempLeads ORDER BY CreatedOn DESC\r\n\t\t\tEND\r\n\r\n\t\tELSE IF (@GetBDAT <> 1 and @GetCDAT = 1) \t\t-- SUBSCRIBED TO DAT FOR CARRIER ONLY\r\n\t\t\tBEGIN\r\n\t\t\t\t-- GET LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@LToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET DAT EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads\r\n\t\t\t\tEXEC [usp_GetDATEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom\r\n\r\n\t\t\t\t-- RETURN ALL LEADS COMBINED (TOP 150 RECORDS IN DESC. ORDER)\r\n\t\t\t\tSELECT TOP 150 * FROM @tempLeads ORDER BY CreatedOn DESC\r\n\t\t\tEND\r\n\r\n\t\tELSE\t\t-- NOT SUBSCRIBED TO DAT AT ALL\r\n\t\t\tBEGIN\r\n\t\t\t\t-- GET LOAD LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetLoadLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@LToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- GET EQUIP. LEADS AND INSERT INTO TEMP LEADS TABLE\r\n\t\t\t\tINSERT @tempLeads  \r\n\t\t\t\tEXEC [usp_GetEquipmentLead] \r\n\t\t\t\t@CustCD = @CustCD         \r\n\t\t\t\t,@EToken = @Token\r\n\t\t\t\t,@ServerName = @ServerName\r\n\t\t\t\t,@Version = @Version\r\n\t\t\t\t,@MileageProvider = @MileageProvider\r\n\t\t\t\t,@LeadFrom = @LeadFrom \r\n\r\n\t\t\t\t-- RETURN ALL LEADS COMBINED (TOP 150 RECORDS IN DESC. ORDER)\r\n\t\t\t\tSELECT TOP 150 * FROM @tempLeads ORDER BY CreatedOn DESC\r\n\t\t\tEND\r\n\tEND","parameters":[{"name":"CustCD","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"ServerName","description":null,"mode":"IN","data_type":"varchar(75)","custom_fields":{}},{"name":"Version","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"MileageProvider","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"LeadFrom","description":null,"mode":"IN","data_type":"datetime2(7)","custom_fields":{}},{"name":"LeadType","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"GetBDAT","description":null,"mode":"IN","data_type":"bit","custom_fields":{}},{"name":"GetCDAT","description":null,"mode":"IN","data_type":"bit","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};