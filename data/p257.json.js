window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p257","name":"usp_GetEquipmentLeadTest","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_GetEquipmentLeadTest"},{"field":"Type","value":"Procedure"}],"script":"--ORIG\r\nCREATE     PROCEDURE [dbo].[usp_GetEquipmentLeadTest] \r\n  @UserID       int         \r\n ,@EToken       int = 0\r\n ,@ServerName Varchar(75) = '' \r\n ,@Version Varchar(50) = 'V4.00'\r\n ,@MileageProvider CHAR(1) = 'G' -- G=Google (Default), P=PCMiler \r\n\r\n\r\n--------------------------------------------------------------------------\r\n--PROCEDURE NAME : usp_GetEquipmentLead\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Get Equipoment Lead for the Users\r\n--\r\n-- CALLED BY      : LoadMatching Web API \r\n-- EXECUTION FREQUENCY : \r\n-- \r\n-- INPUT PARAMS   : \r\n--                 \r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------\r\n-- HISTORY : \r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.01.30 Initial Development\r\n-- Hiro      2018.04.11 Added Contacted\r\n--------------------------------------------------------------------------\r\nas\r\n\r\nDECLARE @CustCD Varchar(10) = ''\r\n---- Get the CustCd from Account Table for Now \r\nSELECT @CustCD = dbo.udf_GetCustCd (@UserId)\r\n\r\n--SET NOCOUNT ON\r\n    SELECT\r\n        L.CustCD ,\r\n        L.DateAvail ,\r\n\r\n        L.SrceID ,\r\n        L.SrceCity ,\r\n        L.SrceSt ,\r\n        L.SrceCountry ,\r\n        L.SrceLong ,\r\n        L.SrceLat ,\r\n\r\n        L.DestID ,\r\n        L.DestCity ,\r\n        L.DestSt ,\r\n        L.DestCountry ,\r\n        L.DestLong ,\r\n        L.DestLat ,\r\n\r\n        dbo.udf_VSizeToString(L.VSize,'L') VehicleSize ,\r\n        dbo.udf_VTypeToString(L.VType) VehicleType ,\r\n        L.Comment ,\r\n        L.PostMode ,\r\n        L.ClientRefNum ,\r\n        L.ProductName ,\r\n        dbo.udf_PostingAttributeToString(L.PAttrib) PostingAttrib ,\r\n        dbo.udf_GetMileage(L.SrceID, L.DestID, @MileageProvider) Distance,\r\n        L.Token      LToken ,\r\n        E.Token      EToken ,\r\n        L.CreatedBy ,\r\n        L.CreatedOn ,\r\n        L.DeletedBy ,\r\n        L.DeletedOn ,\r\n        -- Here are the list of hardcoded field until requirement is finilized.\r\n        ISNULL(A.CommonName,'NA') Company ,\r\n        'Y' QPStatus ,\r\n        -1  EQF_Index , \r\n        -1  TCC_Index ,\r\n        dbo.udf_DestDirection (E.SrceLong, E.SrceLat, L.SrceLong, L.SrceLat) DirO ,\r\n        dbo.udf_GetMileage(E.SrceID, L.SrceID, @MileageProvider) DFO ,\r\n        dbo.udf_GetMileage(E.DestID, L.DestID, @MileageProvider) DFD ,\r\n        CASE WHEN Cn.LToken IS NULL THEN ''       \r\n             ELSE 'Y' END AS Contacted\r\n    FROM dbo.EquipmentLead EL   INNER JOIN dbo.LoadPosting L ON EL.LToken=L.Token\r\n                                INNER JOIN dbo.EquipmentPosting E ON EL.EToken=E.Token\r\n                                LEFT JOIN  dbo.AccountInMem A ON A.CustCD = L.CustCd\r\n                                LEFT JOIN  dbo.Contacted Cn  ON (Cn.EToken = 0 AND Cn.LToken = EL.LToken AND Cn.CustCd = E.CustCd AND Cn.CnCustCd = L.CustCd)\r\n                                -- Once Account information is accessible Contacted and Finance Index will be returned\r\n                                --LEFT JOIN dbo.DnBCredit DNB  on DNB.CUSTCD = c.Cust_Cd\r\n                                --LEFT JOIN dbo.Equifax   EQF  on EQF.CUST_CD = C.Cust_Cd  \r\n                                --LEFT JOIN dbo.TransCreditCA TCC  on TCC.CustCd = C.CUST_CD\r\n    WHERE E.CustCd = @CustCd\r\n    AND (@EToken = 0 OR @EToken = E.Token)\r\n    AND (E.DeletedOn IS NULL)\r\n    AND (L.DeletedOn IS NULL)\r\n    AND  L.PStatus = 'O' -- Open\r\n--END\r\n\r\n\r\nGRANT EXECUTE ON  [dbo].[usp_GetEquipmentLead] TO [udb_platform]","parameters":[{"name":"UserID","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"EToken","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"ServerName","description":null,"mode":"IN","data_type":"varchar(75)","custom_fields":{}},{"name":"Version","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"MileageProvider","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};