window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p327","name":"usp_UpdateTemplatePosting","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_UpdateTemplatePosting"},{"field":"Type","value":"Procedure"}],"script":"-- =========================================================================================== \r\n\r\nCREATE PROCEDURE  [dbo].[usp_UpdateTemplatePosting]\r\n    @TemplateId     int ,\r\n    @TemplateName   varchar(100)  = '',\r\n    @PostType       char(1) ,\r\n    @UserId         int ,\r\n    @DateAvail      date          = null,\r\n\r\n    @SrceId         int           = 0,\r\n    @SrceCity       varchar(50)   = '' ,\r\n    @SrceSt         varchar(2)    = '' ,\r\n    @SrceRadius     int           = 0 ,\r\n\r\n    @DestId         int           = 0,\r\n    @DestCity       varchar(50)   = '' ,\r\n    @DestSt         varchar(2)    = '' ,\r\n    @DestRadius     int           = 0 ,\r\n\r\n    @VSize          INT ,\r\n    @VType          int ,\r\n    @Comment        varchar(4096) = '' ,\r\n    @PostMode       char(1) ,\r\n    @ClientRefNum   varchar(256)  = '',\r\n    @PAttrib        INT        = 0 ,\r\n    @NetworkId      int           = 0 ,\r\n    @Corridor       char(1)       = '' ,\r\n    @CustCd         varchar(10)   = '' ,\r\n\t@CustomerTracking BIT           = 0\r\nAS\r\nBEGIN\r\n\r\nBEGIN TRY\r\n-----------------------------------------------------------------------\r\n-- PROCEDURE NAME : usp_UpdateTemplatePosting\r\n--------------------------------------------------------------------------\r\n-- DESCRIPTION    : Update record from TemplatePosting table for given TemplateID\r\n--\r\n-- ASSUMPTIONS    : \r\n-- CALLED BY      : \r\n-- EXECUTION FREQUENCY : OnDemand\r\n--\r\n-- INPUT PARAMS   : @TemplateID   - ID of Template to be deleted. \r\n--                  @TemplateName - Name of Template \r\n--                  @PostType     - E:Equipment, L:Load \r\n--                  @UserId       - CreatedBy's UserId \r\n--                  @DateAvail    - Available Date\r\n--                  @SrceID       - Source Posting's Point ID \r\n--                  @SrceCity     - Source City  \r\n--                  @SrceSt       - Source Prov/State\r\n--                  @SrceRadius   - Source Radius\r\n--                  @DestID       - Destination Posting's Point ID \r\n--                  @DestCity     - Destination City \r\n--                  @DestSt       - Destination Prov/State \r\n--                  @DestRadius   - Destination Radius\r\n--                  @VSize        - Vehicle Size Code\r\n--                  @VType        - Vehicle Type Code\r\n--                  @Comment      - Comment\r\n--                  @PostMode     - C:Corridor, P:Private Network, A:All\r\n--                  @ClientRefNum - Client Reference Number\r\n--                  @PAttrib      - Posting Attribute Code\r\n--                  @NetworkId    - Private Network ID\r\n--                  @Corridor     - Corridor\r\n--                  @CustCd       - CustCd\r\n-- OUTPUT PARAMS  :\r\n-- STATUS RETURN  : \r\n--------------------------------------------------------------------------------------------------------------------------\r\n-- HISTORY :\r\n-- AUTHOR    DATE       DESCRIPTION\r\n-- Hiro      2018.01.16 Initial Release\r\n-- Hiro      2018.04.25 Added Corridor / CustCd\r\n-- Hiro      2018.10.25 Use the GETDATE() instead of GETUTCDATE() to check if Available Date is valid(Not past), LLSIM-1726\r\n-- Nesrin    2019.11.14 LLSIM-3613: Backend - Update the SP to edit the template posting to save CustomerTracking value\r\n---------------------------------------------------------------------------------------------------------------------------\r\nDECLARE\r\n    @SrceLong       float         = 0 , \r\n    @SrceLat        float         = 0 , \r\n    @SrceCountry    int           = 0 , \r\n    @DestLong       float         = 0 , \r\n    @DestLat        float         = 0 ,\r\n    @DestCountry    int           = 0  \r\n\r\n    -------------------------------------------------------------------------------\r\n    -- Validate DateAvail passed in\r\n    -------------------------------------------------------------------------------\r\n    IF (@DateAvail IS NULL OR CONVERT(date,@DateAvail,112) < CONVERT(date,GETDATE(),112))\r\n       SET @DateAvail = CONVERT(date,GETDATE(),112)\r\n\r\n    -------------------------------------------------------------------------------\r\n    -- Validate Source info\r\n    -------------------------------------------------------------------------------\r\n         \r\n    exec dbo.usp_GetValidLocation\r\n\t    @ID         = @SrceId  OUTPUT,\r\n\t    @City       = @SrceCity OUTPUT,\r\n\t    @StateCode  = @SrceSt OUTPUT,\r\n\t    @Country    = @SrceCountry OUTPUT,\r\n\t    @Long       = @SrceLong  OUTPUT, \r\n\t    @Lat        = @SrceLat  OUTPUT, \r\n\t    @Radius     = @SrceRadius  OUTPUT\r\n \r\n    -------------------------------------------------------------------------------\r\n    -- Validate Destination info\r\n    -------------------------------------------------------------------------------\r\n         \r\n    exec dbo.usp_GetValidLocation\r\n\t    @ID         = @DestId  OUTPUT,\r\n\t    @City       = @DestCity OUTPUT,\r\n\t    @StateCode  = @DestSt OUTPUT,\r\n\t    @Country    = @DestCountry OUTPUT,\r\n\t    @Long       = @DestLong  OUTPUT, \r\n\t    @Lat        = @DestLat  OUTPUT, \r\n\t    @Radius     = @DestRadius  OUTPUT\r\n\r\n\tUPDATE dbo.TemplatePosting \r\n\tSET \r\n        TemplateName     = @TemplateName ,  \r\n        PostType         = @PostType ,\r\n        DateAvail        = @DateAvail ,    \r\n        SrceId           = @SrceId ,       \r\n        SrceCity         = @SrceCity ,     \r\n        SrceSt           = @SrceSt ,       \r\n        SrceRadius       = @SrceRadius ,   \r\n        DestId           = @DestId ,       \r\n        DestCity         = @DestCity ,     \r\n        DestSt           = @DestSt ,       \r\n        DestRadius       = @DestRadius ,   \r\n        VSize            = @VSize ,        \r\n        VType            = @VType ,        \r\n        Comment          = @Comment ,      \r\n        PostMode         = @PostMode ,     \r\n        ClientRefNum     = @ClientRefNum , \r\n        PAttrib          = @PAttrib ,      \r\n        NetworkId        = @NetworkId ,\r\n        UpdatedBy        = @UserId ,\r\n        UpdatedOn        = GETUTCDATE() , \r\n        Corridor         = @Corridor ,\r\n        CustCd           = @CustCd ,\r\n\t\tCustomerTracking = @CustomerTracking\r\n\tWHERE TemplateId     = @TemplateId \r\n\r\nEND TRY\r\nBEGIN CATCH\r\n    SET @TemplateId = -1\r\n\r\n    SELECT \r\n        ERROR_NUMBER() AS ErrorNumber,\r\n        ERROR_MESSAGE() AS ErrorMessage;\r\nEND CATCH;\r\n\r\nSELECT @TemplateId       TemplateId\r\nRETURN @TemplateId\r\n\r\nEND","parameters":[{"name":"TemplateId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"TemplateName","description":null,"mode":"IN","data_type":"varchar(100)","custom_fields":{}},{"name":"PostType","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"UserId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DateAvail","description":null,"mode":"IN","data_type":"date","custom_fields":{}},{"name":"SrceId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"SrceCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"SrceSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"SrceRadius","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"DestCity","description":null,"mode":"IN","data_type":"varchar(50)","custom_fields":{}},{"name":"DestSt","description":null,"mode":"IN","data_type":"varchar(2)","custom_fields":{}},{"name":"DestRadius","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"VSize","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"VType","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"Comment","description":null,"mode":"IN","data_type":"varchar(4096)","custom_fields":{}},{"name":"PostMode","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"ClientRefNum","description":null,"mode":"IN","data_type":"varchar(256)","custom_fields":{}},{"name":"PAttrib","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"NetworkId","description":null,"mode":"IN","data_type":"int","custom_fields":{}},{"name":"Corridor","description":null,"mode":"IN","data_type":"char(1)","custom_fields":{}},{"name":"CustCd","description":null,"mode":"IN","data_type":"varchar(10)","custom_fields":{}},{"name":"CustomerTracking","description":null,"mode":"IN","data_type":"bit","custom_fields":{}}],"dependencies":null,"imported_at":"2021-07-29 12:59"};