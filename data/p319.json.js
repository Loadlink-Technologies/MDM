window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p319","name":"usp_UpdateDatCustomer","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"LoadMatching@UDVLPLL4DATASRV.linklogi.com","id":"d9"}},{"field":"Schema","value":"dbo"},{"field":"Name","value":"usp_UpdateDatCustomer"},{"field":"Type","value":"Procedure"}],"script":"CREATE PROCEDURE [dbo].[usp_UpdateDatCustomer]\r\n\r\n\r\n--@XMT_PH1\t\t\t\tVarchar(17),\r\n--@XMT_PH2\t\t\t\tVarchar(17), \r\n--@XMT_PH3\t\t\t\tVarchar(17), \r\n--@DATCustXref\t\t\tVarchar(20), \r\n--@CustCDIdentity\t\t\tint, \r\n--@TCSI_OFFICE_ID\t\t\tNVarchar(15), \r\n--@XMT_NAME\t\t\t\tVarchar(50), \r\n--@XMT_PHONE\t\t\t\tVarchar(17),\r\n--@ICC\t\t\t\t\tVarchar(20),\r\n--@HOMEPROV\t\t\t\tVarchar(2),\r\n--@LAST_USED\t\t\t\tDatetime,\r\n--@TIA_CompanyID\t\t\tINT,\r\n--@P3Partner\t\t\t\tBIT,\r\n--@COMPANY_ID\t\t\t\tNVarchar(38),\r\n--@POSTER_TYPE\t\t\tNVarchar(12),\r\n--@CUSTOMER_TYPE\t\t\tNVarchar(30),\r\n--@OPEN_DATE\t\t\t\tDateTime,\r\n--@CLOSE_DATE\t\t\t\tDateTime,\r\n--@CUSTOMER_SINCE\t\t\tDateTime,\r\n--@ACCOUNT_COMMENT\t\tNVarchar(50),\r\n--@ACCOUNT_STATUS\t\t\tNVarchar(12),\r\n--@COMPANY_FAX_PHONE\t\tNVarchar(17),\r\n--@DUNS\t\t\t\t\tNVarchar(16),\r\n--@ADDRESS1\t\t\t\tNVarchar(70),\r\n--@ADDRESS2\t\t\t\tNVarchar(70),\r\n--@ADDRESS3\t\t\t\tNVarchar(70),\r\n--@CITY\t\t\t\t\tNVarchar(25),\r\n--@POSTAL_CODE\t\t\tNVarchar(15),\r\n--@FIRST_NAME\t\t\t\tNVarchar(30),\r\n--@LAST_NAME\t\t\t\tNVarchar(70),\r\n--@CONTACT_FAX_PHONE\t\tNVarchar(17),\r\n--@EMAIL_ADDRESS\t\t\tNVarchar(50),\r\n--@CREDIT_SCORE\t\t\tNumeric(18,0),\r\n--@CREDIT_SCORE_DATE\t\tDatetime,\r\n--@RivieraGuid\t\t\tCHAR(36),\r\n--@QPstatus\t\t\t\tCHAR(1),\r\n--@AccountType\t\t\tCHAR(1),\r\n--@GETLOADED_XREF\t\t\tCHAR(32),\r\n--@TIA_MEMBER\t\t\t\tbit,\r\n--@TIA_LEVEL\t\t\t\tINT,\r\n--@BROKER_DOCKET_NUMBER\tVARCHAR(10),\r\n--@CARRIER_DOCKET_NUMBER\tVARCHAR(10),\r\n--@DOT_NUMBER\t\t\t\tVARCHAR(8),\r\n--@ACCOUNT_ID\t\t\t\tVARCHAR(8),\r\n--@USERID\t\t\t\t\tVARCHAR(20),\r\n--@CustCD\t\t\t\t\tINT\r\n\r\nAS\r\n\r\n\r\n--------------------------------------------------------------------------\r\n--PROCEDURE NAME : dbo.usp_UpdateDatCustomer\r\n--------------------------------------------------------------------------\r\n--DESCRIPTION :    update DAT CUSTOMER record   \t\r\n--ASSUMES:\r\n--CALLED BY :\t   \r\n--EXECUTION FREQUENCY : \r\n--PARAMETERS:\r\n--INPUT: @ContactID\r\n--\r\n--\tOUTPUT: None\r\n--STATUS RETURN:\r\n--EXAMPLE:\r\n--------------------------------------------------------------------------\r\n--REMARKS:\r\n--------------------------------------------------------------------------\r\n-- HISTORY: \r\n-- AUTHOR\tDATE\t\tDESCRIPTION\r\n-- Imdad    5/31/2019    Update Dat Customer\r\n-- Nesrin   5Sept2019    LLSIM-3288: Fix DAT customer sync stored procedure logic\r\n--------------------------------------------------------------------------\r\n\r\n--BEGIN TRANSACTION \r\n\r\n--EXEC dbo.usp_UpdateDatCustomer\r\n\r\n\r\nDECLARE @last_used DATETIME\r\nSElECT @last_used = (SELECT MAX(last_used) AS maxlastused FROM datCustomer)\r\n\r\nIF OBJECT_ID('tempdb..#DatCustomer') IS NOT NULL\r\nDROP TABLE #DatCustomer\r\n\r\nSELECT\t\t\t\t\t CUST_CD, DatCustXref, CustCdIdentity, TCSI_OFFICE_ID, XMT_NAME, XMT_PH1, XMT_PH2, XMT_PH3, XMT_PHONE, ICC, HOMEPROV, LAST_USED, TIA_CompanyID, P3Partner, COMPANY_ID, POSTER_TYPE, \r\n                         CUSTOMER_TYPE, OPEN_DATE, CLOSE_DATE, CUSTOMER_SINCE, ACCOUNT_COMMENT, ACCOUNT_STATUS, COMPANY_FAX_PHONE, DUNS, ADDRESS1, ADDRESS2, ADDRESS3, CITY, POSTAL_CODE, \r\n                         FIRST_NAME, LAST_NAME, CONTACT_FAX_PHONE, EMAIL_ADDRESS, CREDIT_SCORE, CREDIT_SCORE_DATE, RivieraGuid, QPstatus, AccountType, GETLOADED_XREF, TIA_MEMBER, TIA_LEVEL, \r\n                         BROKER_DOCKET_NUMBER, CARRIER_DOCKET_NUMBER, DOT_NUMBER, ACCOUNT_ID, USERID\r\n\r\nINTO #DatCustomer\r\nFROM           production.production.dbo.DatCustomer WITH (nolock) --where CUST_CD = 'D096023' \r\nWHERE        (LAST_USED >= @last_used) --AND CUST_CD = 'D096023' \r\n\r\n-- INSERT INTO #DatCust\r\n/*IF OBJECT_ID('tempdb..#DatCustCD') IS NOT NULL\r\nDROP TABLE #DatCustCD\r\nSELECT custcd, last_Used \r\nINTO #DatCustCD\r\nFROM DATCustomer\r\n*/\r\n--SELECT * from  #DatCustomer\r\nINSERT INTO DatCustomer (CustCD, DatCustXref, CustCdIdentity, TCSI_OFFICE_ID, XMT_NAME, XMT_PH1, XMT_PH2, XMT_PH3, XMT_PHONE, ICC, HOMEPROV, LAST_USED, TIA_CompanyID, P3Partner, COMPANY_ID, POSTER_TYPE, \r\n                         CUSTOMER_TYPE, OPEN_DATE, CLOSE_DATE, CUSTOMER_SINCE, ACCOUNT_COMMENT, ACCOUNT_STATUS, COMPANY_FAX_PHONE, DUNS, ADDRESS1, ADDRESS2, ADDRESS3, CITY, POSTAL_CODE, \r\n                         FIRST_NAME, LAST_NAME, CONTACT_FAX_PHONE, EMAIL_ADDRESS, CREDIT_SCORE, CREDIT_SCORE_DATE, RivieraGuid, QPstatus, AccountType, GETLOADED_XREF, TIA_MEMBER, TIA_LEVEL, \r\n                         BROKER_DOCKET_NUMBER, CARRIER_DOCKET_NUMBER, DOT_NUMBER, ACCOUNT_ID, USERID)\r\n\r\n(SELECT Cust_CD, DatCustXref, CustCdIdentity, TCSI_OFFICE_ID, XMT_NAME, XMT_PH1, XMT_PH2, XMT_PH3, XMT_PHONE, ICC, HOMEPROV, Datc.LAST_USED, TIA_CompanyID, P3Partner, COMPANY_ID, POSTER_TYPE, \r\n                         CUSTOMER_TYPE, OPEN_DATE, CLOSE_DATE, CUSTOMER_SINCE, ACCOUNT_COMMENT, ACCOUNT_STATUS, COMPANY_FAX_PHONE, DUNS, ADDRESS1, ADDRESS2, ADDRESS3, CITY, POSTAL_CODE, \r\n                         FIRST_NAME, LAST_NAME, CONTACT_FAX_PHONE, EMAIL_ADDRESS, CREDIT_SCORE, CREDIT_SCORE_DATE, RivieraGuid, QPstatus, AccountType, GETLOADED_XREF, TIA_MEMBER, TIA_LEVEL, \r\n                         BROKER_DOCKET_NUMBER, CARRIER_DOCKET_NUMBER, DOT_NUMBER, ACCOUNT_ID, USERID \r\n\t\t\t\t\t\t \r\n\t\t\t\t\t\t FROM  #DatCustomer Datc --inner join #DatCustCD C on Datc.CUST_CD = C.CustCD\r\n\t\t\t\t\t\t WHERE Cust_CD NOT IN(SELECT CustCD FROM [dbo].[DatCustomer]))\r\n\r\n----Update if the records already exist.\r\n\r\nUPDATE DatCustomer \r\nSET\r\n\r\nXMT_PH1 = DC.XMT_PH1,\r\nXMT_PH2 = DC.XMT_PH2, \r\nXMT_PH3 = DC.XMT_PH3, \r\nDATCustXref = DC.DATCustXref, \r\nCustCDIdentity = DC.CustCDIdentity, \r\nTCSI_OFFICE_ID = DC.TCSI_OFFICE_ID, \r\nXMT_NAME = DC.XMT_NAME, \r\nXMT_PHONE = DC.XMT_PHONE,\r\n[ICC] = DC.ICC,\r\n[HOMEPROV] = DC.HOMEPROV,\r\n[LAST_USED] = DC.LAST_USED,\r\n[TIA_CompanyID] = DC.TIA_CompanyID,\r\n[P3Partner] = DC.P3Partner,\r\n[COMPANY_ID] = DC.COMPANY_ID,\r\n[POSTER_TYPE] = DC.POSTER_TYPE,\r\n[CUSTOMER_TYPE] = DC.CUSTOMER_TYPE,\r\n[OPEN_DATE] = DC.OPEN_DATE,\r\n[CLOSE_DATE] = DC.CLOSE_DATE,\r\n[CUSTOMER_SINCE] = DC.CUSTOMER_SINCE,\r\n[ACCOUNT_COMMENT] = DC.ACCOUNT_COMMENT,\r\n[ACCOUNT_STATUS] = DC.ACCOUNT_STATUS,\r\n[COMPANY_FAX_PHONE] =DC.COMPANY_FAX_PHONE,\r\n[DUNS] = DC.DUNS,\r\n[ADDRESS1] = DC.ADDRESS1,\r\n[ADDRESS2] = DC.ADDRESS2,\r\n[ADDRESS3] = DC.ADDRESS3,\r\n[CITY] = DC.CITY,\r\n[POSTAL_CODE] = DC.POSTAL_CODE,\r\n[FIRST_NAME] = DC.FIRST_NAME,\r\n[LAST_NAME] = DC.LAST_NAME,\r\n[CONTACT_FAX_PHONE] = DC.CONTACT_FAX_PHONE,\r\n[EMAIL_ADDRESS] = DC.EMAIL_ADDRESS,\r\n[CREDIT_SCORE] = DC.CREDIT_SCORE,\r\n[CREDIT_SCORE_DATE] = DC.CREDIT_SCORE_DATE,\r\n[RivieraGuid] = DC.RivieraGuid,\r\n[QPstatus] = DC.QPstatus,\r\n[AccountType] = DC.AccountType,\r\n[GETLOADED_XREF] = DC.GETLOADED_XREF,\r\n[TIA_MEMBER] = DC.TIA_MEMBER,\r\n[TIA_LEVEL] = DC.TIA_LEVEL,\r\n[BROKER_DOCKET_NUMBER] = DC.BROKER_DOCKET_NUMBER,\r\n[CARRIER_DOCKET_NUMBER] = DC.CARRIER_DOCKET_NUMBER,\r\n[DOT_NUMBER] = DC.DOT_NUMBER,\r\n[ACCOUNT_ID] = DC.ACCOUNT_ID,\r\n[USERID] = DC.USERID \r\nFROM #DatCustomer AS DC\r\n--FROM [dbo].[DatCustomer] AS C\r\nINNER JOIN [dbo].[DatCustomer] AS C\r\nON C.CustCD = DC.CUST_CD\r\n--WHERE C.CustCD IN (select CustCD from [dbo].[DatCustomer])\r\n\r\n--select top 100*  FROM production.production.dbo.DatCustomer with (nolock) where CUST_CD = 'D096023' \r\n\r\n--select top 100* from  datCustomer with (nolock) where CustCD = 'D096023'\r\n\r\n\r\n\r\n--COMMIT TRANSACTION","parameters":[],"dependencies":null,"imported_at":"2021-07-29 12:59"};